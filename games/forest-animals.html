<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Forest Animals Showcase</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;overflow:hidden}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  background:#071a10;color:white;
  -webkit-user-select:none;user-select:none;
}

.scene{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.firefly{
  position:absolute;width:4px;height:4px;border-radius:50%;
  background:#ffd54f;box-shadow:0 0 8px 3px rgba(255,213,79,.5);
  animation:fly var(--dur) ease-in-out infinite;
}
@keyframes fly{
  0%{opacity:0;transform:translate(0,0)}
  25%{opacity:1}
  50%{opacity:.3;transform:translate(var(--dx),var(--dy))}
  75%{opacity:1}
  100%{opacity:0;transform:translate(0,0)}
}
.leaf{
  position:absolute;font-size:16px;opacity:0;
  animation:leafDrop var(--dur) linear infinite;
}
@keyframes leafDrop{
  0%{transform:translate(0,-20px) rotate(0);opacity:0}
  10%{opacity:.6}90%{opacity:.4}
  100%{transform:translate(var(--dx),100vh) rotate(720deg);opacity:0}
}

.app{
  position:relative;z-index:1;
  width:100%;height:100%;
  display:flex;flex-direction:column;
}

.header{
  flex-shrink:0;text-align:center;
  padding:10px 20px 4px;
}
.header h1{
  font-size:clamp(18px,2.8vw,28px);font-weight:800;
  color:#a5d6a7;text-shadow:0 3px 12px rgba(0,0,0,.6);
}
.header p{
  font-size:clamp(10px,1.3vw,13px);
  color:rgba(255,255,255,.45);
}

.page-area{
  flex:1;position:relative;min-height:0;
  display:flex;align-items:center;
  padding:0 4px;
}

.page-viewport{
  flex:1;height:100%;overflow:hidden;
  margin:0 48px;
}
.page-track{
  display:flex;height:100%;
  transition:transform .5s cubic-bezier(.4,0,.2,1);
}
.page-slide{
  min-width:100%;height:100%;
  padding:4px 8px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  grid-template-rows:repeat(2,1fr);
  gap:8px;
  width:100%;height:100%;
}

.card{
  background:rgba(255,255,255,.05);
  border:1px solid rgba(129,199,132,.2);
  border-radius:14px;
  display:flex;flex-direction:column;
  overflow:hidden;
  transition:border-color .3s,box-shadow .3s,transform .2s;
  cursor:pointer;
  position:relative;
}
.card:hover,.card:active{
  border-color:rgba(129,199,132,.5);
  box-shadow:0 4px 24px rgba(0,0,0,.4),0 0 16px rgba(129,199,132,.1);
}
.card:active{transform:scale(.97)}
.card.flipped .card-front{display:none}
.card.flipped .card-back{display:flex}

.card-front{
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  flex:1;padding:8px;gap:4px;
  text-align:center;
}
.card-emoji{font-size:clamp(36px,5vw,56px);line-height:1.1;filter:drop-shadow(0 4px 12px rgba(0,0,0,.5))}
.card-name{
  font-size:clamp(13px,1.5vw,18px);font-weight:700;
  color:#a5d6a7;
}
.card-latin{
  font-size:clamp(8px,.8vw,10px);font-style:italic;
  color:rgba(255,255,255,.3);
}
.card-tap{
  font-size:clamp(8px,.7vw,9px);
  color:rgba(255,255,255,.2);margin-top:2px;
}

.card-back{
  display:none;flex-direction:column;
  flex:1;padding:10px 12px;gap:6px;
  overflow-y:auto;
}
.back-header{
  display:flex;align-items:center;gap:8px;
  padding-bottom:4px;border-bottom:1px solid rgba(129,199,132,.15);
}
.back-emoji{font-size:clamp(22px,2.5vw,30px)}
.back-name{font-size:clamp(14px,1.5vw,18px);font-weight:700;color:#a5d6a7}
.back-facts{list-style:none;padding:0;flex:1}
.back-facts li{
  font-size:clamp(10px,1.1vw,13px);
  color:rgba(255,255,255,.75);
  line-height:1.5;
  padding:3px 0 3px 18px;
  position:relative;
}
.back-facts li::before{
  content:'';position:absolute;left:2px;top:50%;
  transform:translateY(-50%);
  width:8px;height:8px;border-radius:50%;
  background:rgba(129,199,132,.5);
  border:1px solid rgba(129,199,132,.7);
}
.back-facts li:nth-child(2)::before{background:rgba(255,193,7,.5);border-color:rgba(255,193,7,.7)}
.back-facts li:nth-child(3)::before{background:rgba(79,195,247,.5);border-color:rgba(79,195,247,.7)}
.back-facts li:nth-child(4)::before{background:rgba(239,154,154,.5);border-color:rgba(239,154,154,.7)}
.back-facts li:nth-child(5)::before{background:rgba(206,147,216,.5);border-color:rgba(206,147,216,.7)}
.card-sound{
  display:flex;align-items:center;justify-content:center;gap:5px;
  padding:5px 10px;margin-top:auto;
  background:rgba(129,199,132,.1);
  border:1px solid rgba(129,199,132,.3);
  border-radius:16px;color:#a5d6a7;
  font-size:clamp(9px,1vw,12px);font-weight:600;
  cursor:pointer;transition:all .3s;
  align-self:flex-start;
}
.card-sound:hover,.card-sound:active{background:rgba(129,199,132,.22)}
.card-sound.playing{background:rgba(129,199,132,.3);border-color:rgba(129,199,132,.6)}

.arrow-btn{
  position:absolute;top:50%;transform:translateY(-50%);
  width:clamp(38px,4vw,48px);height:clamp(38px,4vw,48px);
  border-radius:50%;
  background:rgba(0,0,0,.55);backdrop-filter:blur(8px);
  border:2px solid rgba(129,199,132,.35);
  color:white;font-size:clamp(14px,1.8vw,20px);
  cursor:pointer;z-index:10;
  display:flex;align-items:center;justify-content:center;
  transition:all .3s;
}
.arrow-btn:hover{background:rgba(129,199,132,.2);border-color:rgba(129,199,132,.6)}
.arrow-btn:active{transform:translateY(-50%) scale(.92)}
.arrow-btn:disabled{opacity:.2;cursor:default;transform:translateY(-50%)}
.arrow-left{left:4px}
.arrow-right{right:4px}

.page-dots{
  flex-shrink:0;display:flex;justify-content:center;
  gap:8px;padding:6px 0;
}
.dot{
  width:10px;height:10px;border-radius:50%;
  background:rgba(129,199,132,.15);
  border:2px solid rgba(129,199,132,.3);
  cursor:pointer;transition:all .3s;
}
.dot.active{background:#81c784;transform:scale(1.3);border-color:#81c784}

.footer{
  flex-shrink:0;text-align:center;
  padding:2px 20px 10px;
}
.btn-back{
  padding:8px 26px;font-size:14px;font-weight:600;
  background:rgba(129,199,132,.1);
  border:2px solid rgba(129,199,132,.3);
  color:white;border-radius:50px;cursor:pointer;
  transition:all .3s;backdrop-filter:blur(8px);
}
.btn-back:hover,.btn-back:active{background:rgba(129,199,132,.2);border-color:rgba(129,199,132,.5)}

.touch-ring{
  position:fixed;width:60px;height:60px;
  border:3px solid rgba(129,199,132,.6);border-radius:50%;
  pointer-events:none;z-index:9999;
  transform:translate(-50%,-50%) scale(0);
  animation:ringPop .6s ease forwards;
}
@keyframes ringPop{
  0%{transform:translate(-50%,-50%) scale(0);opacity:1}
  100%{transform:translate(-50%,-50%) scale(2);opacity:0}
}

@media(max-width:700px){
  .grid{grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(3,1fr)}
  .page-viewport{margin:0 40px}
}
@media(max-width:420px){
  .grid{gap:5px}
  .card-back{padding:8px}
}
</style>
</head>
<body>
<div class="scene" id="scene"></div>

<div class="app">
  <div class="header">
    <h1>Forest Animals Showcase</h1>
    <p>Tap any animal to learn fun facts -- swipe pages to see more</p>
  </div>

  <div class="page-area">
    <button class="arrow-btn arrow-left" id="prevBtn">&#9664;</button>
    <div class="page-viewport">
      <div class="page-track" id="pageTrack"></div>
    </div>
    <button class="arrow-btn arrow-right" id="nextBtn">&#9654;</button>
  </div>

  <div class="page-dots" id="pageDots"></div>

  <div class="footer">
    <button class="btn-back" id="backBtn">Back to Menu</button>
  </div>
</div>

<script>
var ANIMALS = [
  {
    name:'Red Deer', latin:'Cervus elaphus', emoji:'\uD83E\uDD8C',
    facts:[
      'Antlers grow up to 1 inch per day -- fastest bone growth in nature!',
      'Males roar up to 20 times per minute during mating season',
      'Can run at 40 mph -- faster than a city bus!',
      'Shed and regrow their antlers every single year',
      'Babies (fawns) are born with white spots for camouflage'
    ],
    sound:{type:'bellow',freq:130,dur:0.9}
  },
  {
    name:'Red Fox', latin:'Vulpes vulpes', emoji:'\uD83E\uDD8A',
    facts:[
      'Can hear a watch ticking from 40 yards away!',
      'Use Earth\'s magnetic field like a compass to hunt',
      'Have over 40 different calls and vocalizations',
      'Their pupils are vertical slits -- just like a cat!',
      'Pounce on prey using a special "mousing leap"'
    ],
    sound:{type:'bark',freq:800,dur:0.12}
  },
  {
    name:'Brown Bear', latin:'Ursus arctos', emoji:'\uD83D\uDC3B',
    facts:[
      'Can eat 90 pounds of food per day before winter sleep!',
      'Sprint at 35 mph -- faster than most horses',
      'Nose is 7 times better than a bloodhound\'s',
      'Hibernate for 5 to 7 months without eating or drinking',
      'Cubs are born blind and weigh less than a pound'
    ],
    sound:{type:'growl',freq:75,dur:1.2}
  },
  {
    name:'Great Horned Owl', latin:'Bubo virginianus', emoji:'\uD83E\uDD89',
    facts:[
      'Can turn their head 270 degrees -- almost all the way around!',
      'Fly in complete silence thanks to special feather edges',
      'Eyes are fixed in place -- they can\'t move them at all',
      'Grip strength is 300 PSI -- 10x stronger than a human hand',
      'Hunt in pitch darkness using only sound to locate prey'
    ],
    sound:{type:'hoot',freq:300,dur:0.4}
  },
  {
    name:'Raccoon', latin:'Procyon lotor', emoji:'\uD83E\uDD9D',
    facts:[
      'Can remember how to solve puzzles for 3 whole years!',
      'Front paws are incredibly sensitive -- like tiny human hands',
      'Wash their food in water before eating it',
      'Can rotate their hind feet 180 degrees to climb DOWN trees',
      'Active mostly at night with amazing night vision'
    ],
    sound:{type:'chitter',freq:600,dur:0.06}
  },
  {
    name:'Red Squirrel', latin:'Sciurus vulgaris', emoji:'\uD83D\uDC3F\uFE0F',
    facts:[
      'Bury up to 10,000 nuts each autumn as food stores!',
      'Can leap 10 times their own body length in one jump',
      'Front teeth never stop growing -- they gnaw to keep them short',
      'Plant thousands of trees by forgetting where they buried nuts',
      'Tail is used as a blanket, umbrella, and balance beam'
    ],
    sound:{type:'chirp',freq:900,dur:0.15}
  },
  {
    name:'Beaver', latin:'Castor fiber', emoji:'\uD83E\uDDAB',
    facts:[
      'Build dams that can stretch over 800 meters long!',
      'Hold their breath underwater for up to 15 minutes',
      'Teeth are orange because they contain iron -- super strong!',
      'Slap their flat tail on water to warn others of danger',
      'Second-largest rodent in the world after the capybara'
    ],
    sound:{type:'slap',freq:200,dur:0.15}
  },
  {
    name:'Grey Wolf', latin:'Canis lupus', emoji:'\uD83D\uDC3A',
    facts:[
      'Howls can be heard from 16 kilometers away!',
      'Each wolf has a unique howl -- like a voice fingerprint',
      'Hunt in organized packs with complex strategies',
      'Can travel 50 miles in a single day while hunting',
      'Pups are cared for by the entire pack, not just parents'
    ],
    sound:{type:'howl',freq:220,dur:2.0}
  },
  {
    name:'Golden Eagle', latin:'Aquila chrysaetos', emoji:'\uD83E\uDD85',
    facts:[
      'Dive at speeds up to 240 km/h -- faster than a sports car!',
      'Can spot a rabbit from over 3 kilometers away',
      'Eyesight is 8 times sharper than a human\'s',
      'Wingspan reaches up to 2.3 meters (7.5 feet) wide',
      'Mate for life and use the same nest for decades'
    ],
    sound:{type:'screech',freq:1800,dur:0.6}
  },
  {
    name:'Hedgehog', latin:'Erinaceus europaeus', emoji:'\uD83E\uDD94',
    facts:[
      'Covered in about 7,000 spines that are replaced each year!',
      'Curl into a tight spiky ball when scared -- nearly impossible to open',
      'Immune to some snake venoms that would harm other animals',
      'Snore loudly when they sleep -- just like humans!',
      'Can run over 6 feet per second despite tiny legs'
    ],
    sound:{type:'snuffle',freq:400,dur:0.5}
  },
  {
    name:'Forest Gecko', latin:'Phelsuma grandis', emoji:'\uD83E\uDD8E',
    facts:[
      'Can regrow their tail if a predator grabs it!',
      'Toe pads have millions of tiny hairs that stick to any surface',
      'No eyelids -- they lick their eyeballs to keep them clean',
      'Some species can change color to match their surroundings',
      'Can climb straight up glass walls and even walk on ceilings'
    ],
    sound:{type:'click',freq:1500,dur:0.04}
  },
  {
    name:'European Hare', latin:'Lepus europaeus', emoji:'\uD83D\uDC07',
    facts:[
      'Sprint at 70 km/h -- one of the fastest land animals!',
      'Can jump 3 meters high from a standing position',
      'Have nearly 360-degree vision to spot predators everywhere',
      'Born fully furred with eyes open -- ready to run from day one!',
      'Zigzag when running to confuse predators chasing them'
    ],
    sound:{type:'thump',freq:55,dur:0.12}
  }
];

var currentPage = 0;
var CARDS_PER_PAGE = 6;
var totalPages = Math.ceil(ANIMALS.length / CARDS_PER_PAGE);
var track = document.getElementById('pageTrack');
var dotsWrap = document.getElementById('pageDots');
var prevBtn = document.getElementById('prevBtn');
var nextBtn = document.getElementById('nextBtn');

function buildPages() {
  for (var p = 0; p < totalPages; p++) {
    var slide = document.createElement('div');
    slide.className = 'page-slide';

    var grid = document.createElement('div');
    grid.className = 'grid';

    var start = p * CARDS_PER_PAGE;
    var end = Math.min(start + CARDS_PER_PAGE, ANIMALS.length);

    for (var i = start; i < end; i++) {
      var animal = ANIMALS[i];
      var card = document.createElement('div');
      card.className = 'card';
      card.dataset.index = i;

      var front = document.createElement('div');
      front.className = 'card-front';
      front.innerHTML =
        '<div class="card-emoji">' + animal.emoji + '</div>' +
        '<div class="card-name">' + animal.name + '</div>' +
        '<div class="card-latin">' + animal.latin + '</div>' +
        '<div class="card-tap">Tap for fun facts</div>';

      var back = document.createElement('div');
      back.className = 'card-back';
      var factsHtml = '';
      animal.facts.forEach(function(f) {
        factsHtml += '<li>' + f + '</li>';
      });
      back.innerHTML =
        '<div class="back-header"><span class="back-emoji">' + animal.emoji + '</span><span class="back-name">' + animal.name + '</span></div>' +
        '<ul class="back-facts">' + factsHtml + '</ul>' +
        '<button class="card-sound" data-index="' + i + '">&#128266; Play Sound</button>';

      card.appendChild(front);
      card.appendChild(back);
      grid.appendChild(card);
    }

    slide.appendChild(grid);
    track.appendChild(slide);

    var dot = document.createElement('div');
    dot.className = 'dot' + (p === 0 ? ' active' : '');
    dot.dataset.page = p;
    dotsWrap.appendChild(dot);
  }
}

function goToPage(idx) {
  currentPage = Math.max(0, Math.min(totalPages - 1, idx));
  track.style.transform = 'translateX(-' + (currentPage * 100) + '%)';
  prevBtn.disabled = currentPage === 0;
  nextBtn.disabled = currentPage === totalPages - 1;
  var dots = dotsWrap.querySelectorAll('.dot');
  dots.forEach(function(d, i) { d.classList.toggle('active', i === currentPage); });
}

function handleCardTap(card) {
  card.classList.toggle('flipped');
}

function handleSoundTap(btn) {
  var idx = parseInt(btn.dataset.index);
  playAnimalSound(ANIMALS[idx].sound, btn);
}

function bindTouch(el, fn) {
  el.addEventListener('click', function(e) {
    if (e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents) return;
    fn(e);
  });
  el.addEventListener('touchend', function(e) {
    e.preventDefault();
    e.stopPropagation();
    fn(e);
  });
}

document.addEventListener('click', function(e) {
  if (e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents) return;
  handleDelegated(e);
});
document.addEventListener('touchend', function(e) {
  var target = e.target;
  if (target.closest('.card-sound') || target.closest('.card') || target.closest('.dot') || target.closest('.arrow-btn') || target.closest('.btn-back')) {
    e.preventDefault();
    handleDelegated(e);
  }
});

function handleDelegated(e) {
  var target = e.target;

  var soundBtn = target.closest('.card-sound');
  if (soundBtn) {
    handleSoundTap(soundBtn);
    return;
  }

  var card = target.closest('.card');
  if (card) {
    handleCardTap(card);
    return;
  }

  var dot = target.closest('.dot');
  if (dot) {
    goToPage(parseInt(dot.dataset.page));
    return;
  }
}

bindTouch(prevBtn, function() { goToPage(currentPage - 1); });
bindTouch(nextBtn, function() { goToPage(currentPage + 1); });
bindTouch(document.getElementById('backBtn'), function() { location.href = '../index.html'; });

function playAnimalSound(cfg, btn) {
  if (btn.classList.contains('playing')) return;
  btn.classList.add('playing');
  try {
    var ac = new (window.AudioContext || window.webkitAudioContext)();
    var now = ac.currentTime;

    if (cfg.type === 'bellow') {
      var o = ac.createOscillator(), g = ac.createGain();
      o.connect(g); g.connect(ac.destination);
      o.type = 'triangle'; o.frequency.setValueAtTime(cfg.freq, now);
      o.frequency.linearRampToValueAtTime(cfg.freq * 0.8, now + cfg.dur);
      var lfo = ac.createOscillator(), lfoG = ac.createGain();
      lfo.connect(lfoG); lfoG.connect(o.frequency);
      lfo.frequency.value = 5; lfoG.gain.value = 15; lfo.start(now);
      g.gain.setValueAtTime(0, now);
      g.gain.linearRampToValueAtTime(0.2, now + 0.1);
      g.gain.linearRampToValueAtTime(0.15, now + cfg.dur * 0.7);
      g.gain.exponentialRampToValueAtTime(0.001, now + cfg.dur);
      o.start(now); o.stop(now + cfg.dur); lfo.stop(now + cfg.dur);
    }
    else if (cfg.type === 'bark') {
      for (var b = 0; b < 3; b++) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.type = 'square';
        var t = now + b * 0.18;
        o.frequency.setValueAtTime(cfg.freq, t);
        o.frequency.exponentialRampToValueAtTime(cfg.freq * 0.5, t + cfg.dur);
        g.gain.setValueAtTime(0.15, t);
        g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur);
        o.start(t); o.stop(t + cfg.dur);
      }
    }
    else if (cfg.type === 'growl') {
      var o = ac.createOscillator(), g = ac.createGain();
      o.connect(g); g.connect(ac.destination);
      o.type = 'sawtooth'; o.frequency.value = cfg.freq;
      var lfo = ac.createOscillator(), lfoG = ac.createGain();
      lfo.connect(lfoG); lfoG.connect(o.frequency);
      lfo.frequency.value = 3; lfoG.gain.value = 10; lfo.start(now);
      g.gain.setValueAtTime(0, now);
      g.gain.linearRampToValueAtTime(0.12, now + 0.2);
      g.gain.setValueAtTime(0.12, now + cfg.dur * 0.6);
      g.gain.exponentialRampToValueAtTime(0.001, now + cfg.dur);
      o.start(now); o.stop(now + cfg.dur); lfo.stop(now + cfg.dur);
    }
    else if (cfg.type === 'hoot') {
      [cfg.freq, cfg.freq * 0.82].forEach(function(f, i) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.type = 'sine'; o.frequency.value = f;
        var t = now + i * (cfg.dur + 0.15);
        g.gain.setValueAtTime(0, t);
        g.gain.linearRampToValueAtTime(0.18, t + 0.05);
        g.gain.setValueAtTime(0.18, t + cfg.dur * 0.7);
        g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur);
        o.start(t); o.stop(t + cfg.dur);
      });
    }
    else if (cfg.type === 'chitter') {
      for (var c = 0; c < 12; c++) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.type = 'square';
        var t = now + c * cfg.dur;
        o.frequency.value = cfg.freq + Math.random() * 200;
        g.gain.setValueAtTime(0.1, t);
        g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur * 0.8);
        o.start(t); o.stop(t + cfg.dur);
      }
    }
    else if (cfg.type === 'chirp') {
      for (var ch = 0; ch < 4; ch++) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.type = 'sine';
        var t = now + ch * 0.2;
        o.frequency.setValueAtTime(cfg.freq, t);
        o.frequency.exponentialRampToValueAtTime(cfg.freq * 1.8, t + cfg.dur);
        g.gain.setValueAtTime(0.15, t);
        g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur);
        o.start(t); o.stop(t + cfg.dur);
      }
    }
    else if (cfg.type === 'slap') {
      var buf = ac.createBuffer(1, ac.sampleRate * cfg.dur, ac.sampleRate);
      var data = buf.getChannelData(0);
      for (var s = 0; s < data.length; s++) {
        data[s] = (Math.random() * 2 - 1) * Math.exp(-s / (ac.sampleRate * 0.02));
      }
      var src = ac.createBufferSource(), g = ac.createGain();
      src.buffer = buf; src.connect(g); g.connect(ac.destination);
      g.gain.setValueAtTime(0.3, now);
      g.gain.exponentialRampToValueAtTime(0.001, now + cfg.dur);
      src.start(now);
    }
    else if (cfg.type === 'howl') {
      var o = ac.createOscillator(), g = ac.createGain();
      o.connect(g); g.connect(ac.destination);
      o.type = 'sine';
      o.frequency.setValueAtTime(cfg.freq, now);
      o.frequency.linearRampToValueAtTime(cfg.freq * 2.5, now + cfg.dur * 0.4);
      o.frequency.linearRampToValueAtTime(cfg.freq * 2.2, now + cfg.dur * 0.7);
      o.frequency.linearRampToValueAtTime(cfg.freq * 1.5, now + cfg.dur);
      var lfo = ac.createOscillator(), lfoG = ac.createGain();
      lfo.connect(lfoG); lfoG.connect(o.frequency);
      lfo.frequency.value = 4; lfoG.gain.value = 8; lfo.start(now);
      g.gain.setValueAtTime(0, now);
      g.gain.linearRampToValueAtTime(0.18, now + 0.15);
      g.gain.setValueAtTime(0.18, now + cfg.dur * 0.6);
      g.gain.exponentialRampToValueAtTime(0.001, now + cfg.dur);
      o.start(now); o.stop(now + cfg.dur); lfo.stop(now + cfg.dur);
    }
    else if (cfg.type === 'screech') {
      var o = ac.createOscillator(), g = ac.createGain();
      o.connect(g); g.connect(ac.destination);
      o.type = 'sawtooth';
      o.frequency.setValueAtTime(cfg.freq, now);
      o.frequency.exponentialRampToValueAtTime(cfg.freq * 0.4, now + cfg.dur);
      g.gain.setValueAtTime(0.1, now);
      g.gain.exponentialRampToValueAtTime(0.001, now + cfg.dur);
      o.start(now); o.stop(now + cfg.dur);
    }
    else if (cfg.type === 'snuffle') {
      for (var sn = 0; sn < 5; sn++) {
        var buf = ac.createBuffer(1, ac.sampleRate * 0.08, ac.sampleRate);
        var data = buf.getChannelData(0);
        for (var s = 0; s < data.length; s++) data[s] = (Math.random() * 2 - 1) * 0.3;
        var src = ac.createBufferSource(), g = ac.createGain();
        var filt = ac.createBiquadFilter();
        filt.type = 'lowpass'; filt.frequency.value = cfg.freq;
        src.buffer = buf; src.connect(filt); filt.connect(g); g.connect(ac.destination);
        var t = now + sn * 0.12;
        g.gain.setValueAtTime(0.12, t);
        g.gain.exponentialRampToValueAtTime(0.001, t + 0.08);
        src.start(t);
      }
    }
    else if (cfg.type === 'click') {
      for (var ck = 0; ck < 3; ck++) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.type = 'sine'; o.frequency.value = cfg.freq;
        var t = now + ck * 0.1;
        g.gain.setValueAtTime(0.2, t);
        g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur);
        o.start(t); o.stop(t + cfg.dur);
      }
    }
    else if (cfg.type === 'thump') {
      for (var th = 0; th < 3; th++) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.type = 'sine'; o.frequency.value = cfg.freq;
        var t = now + th * 0.2;
        g.gain.setValueAtTime(0.25, t);
        g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur);
        o.start(t); o.stop(t + cfg.dur);
      }
    }

    var totalDur = cfg.type === 'howl' ? cfg.dur : (cfg.type === 'bark' ? 0.6 : cfg.type === 'chitter' ? 0.8 : cfg.type === 'chirp' ? 0.8 : cfg.type === 'hoot' ? 1.1 : cfg.type === 'snuffle' ? 0.7 : cfg.type === 'click' ? 0.3 : cfg.type === 'thump' ? 0.6 : cfg.dur + 0.1);
    setTimeout(function() { btn.classList.remove('playing'); }, totalDur * 1000);
  } catch (e) {
    btn.classList.remove('playing');
  }
}

buildPages();
goToPage(0);

var sc = document.getElementById('scene');
for (var i = 0; i < 20; i++) {
  var f = document.createElement('div');
  f.className = 'firefly';
  f.style.left = (Math.random() * 100) + '%';
  f.style.top = (Math.random() * 100) + '%';
  f.style.setProperty('--dur', (3 + Math.random() * 5) + 's');
  f.style.setProperty('--dx', ((Math.random() - .5) * 100) + 'px');
  f.style.setProperty('--dy', ((Math.random() - .5) * 100) + 'px');
  f.style.animationDelay = (Math.random() * 5) + 's';
  sc.appendChild(f);
}
var leafEmojis = ['\uD83C\uDF43', '\uD83C\uDF42', '\uD83C\uDF41'];
for (var i = 0; i < 8; i++) {
  var l = document.createElement('div');
  l.className = 'leaf';
  l.textContent = leafEmojis[Math.floor(Math.random() * leafEmojis.length)];
  l.style.left = (Math.random() * 100) + '%';
  l.style.setProperty('--dur', (8 + Math.random() * 6) + 's');
  l.style.setProperty('--dx', ((Math.random() - .5) * 150) + 'px');
  l.style.animationDelay = (Math.random() * 10) + 's';
  sc.appendChild(l);
}

document.addEventListener('touchstart', function(e) {
  for (var i = 0; i < e.changedTouches.length; i++) {
    var t = e.changedTouches[i];
    var ring = document.createElement('div');
    ring.className = 'touch-ring';
    ring.style.left = t.clientX + 'px';
    ring.style.top = t.clientY + 'px';
    document.body.appendChild(ring);
    ring.addEventListener('animationend', function() { this.remove(); });
  }
}, { passive: true });

var touchStartX = 0;
track.addEventListener('touchstart', function(e) {
  touchStartX = e.changedTouches[0].clientX;
}, { passive: true });
track.addEventListener('touchend', function(e) {
  var dx = e.changedTouches[0].clientX - touchStartX;
  if (Math.abs(dx) > 50) {
    if (dx < 0) goToPage(currentPage + 1);
    else goToPage(currentPage - 1);
  }
}, { passive: true });
</script>
</body>
</html>
