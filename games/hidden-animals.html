<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hidden Animals - Find Them All!</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #051810;
            overflow: hidden;
            color: white;
            -webkit-user-select: none;
            user-select: none;
            touch-action: none;
        }

        .game-wrap {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        canvas { position: absolute; inset: 0; }

        .hud {
            position: absolute;
            top: 16px;
            left: 16px;
            display: flex;
            gap: 12px;
            z-index: 100;
            pointer-events: none;
        }

        .hud-box {
            background: rgba(15, 35, 25, 0.92);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(76, 175, 80, 0.45);
            border-radius: 14px;
            padding: 12px 20px;
            pointer-events: auto;
            text-align: center;
            min-width: 90px;
        }

        .hud-label { font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 2px; }
        .hud-value { font-size: 28px; font-weight: 700; color: #81c784; }

        .checklist {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(15, 35, 25, 0.94);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(76, 175, 80, 0.45);
            border-radius: 14px;
            padding: 16px;
            width: 220px;
            z-index: 100;
            max-height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .checklist-title {
            font-size: 16px;
            font-weight: 700;
            color: #81c784;
            text-align: center;
            margin-bottom: 12px;
        }

        .cl-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin-bottom: 6px;
            background: rgba(255,255,255,0.04);
            border-radius: 8px;
            transition: all 0.35s ease;
        }

        .cl-item.found {
            background: rgba(76, 175, 80, 0.25);
            border: 1px solid rgba(76, 175, 80, 0.4);
        }

        .cl-icon {
            font-size: 22px;
            filter: grayscale(1) brightness(0.6);
            transition: all 0.35s ease;
            flex-shrink: 0;
        }

        .cl-item.found .cl-icon {
            filter: none;
            animation: iconPop 0.5s ease;
        }

        @keyframes iconPop {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.35); }
        }

        .cl-name {
            font-size: 14px;
            color: rgba(255,255,255,0.6);
            flex: 1;
        }

        .cl-item.found .cl-name { color: white; font-weight: 600; }

        .btn-row {
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 14px;
            z-index: 100;
        }

        .btn {
            padding: 13px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid;
        }

        .btn-hint {
            background: rgba(255, 193, 7, 0.2);
            border-color: rgba(255, 193, 7, 0.5);
            color: white;
        }

        .btn-hint:hover { background: rgba(255, 193, 7, 0.3); transform: scale(1.05); }
        .btn-hint:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

        .btn-back {
            background: rgba(129, 199, 132, 0.15);
            border-color: rgba(129, 199, 132, 0.4);
            color: white;
        }

        .btn-back:hover { background: rgba(129, 199, 132, 0.25); transform: scale(1.05); }

        .touch-indicator {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 35, 25, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(76, 175, 80, 0.4);
            border-radius: 14px;
            padding: 8px 18px;
            font-size: 13px;
            color: #a5d6a7;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .touch-indicator.visible { opacity: 1; }

        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.88);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .overlay.show { display: flex; }

        .overlay-box {
            text-align: center;
            padding: 40px;
            background: rgba(20, 50, 35, 0.96);
            backdrop-filter: blur(20px);
            border: 3px solid rgba(129, 199, 132, 0.7);
            border-radius: 24px;
            max-width: 480px;
            animation: boxIn 0.4s ease;
        }

        @keyframes boxIn {
            from { transform: scale(0.7); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .overlay-title { font-size: 44px; color: #81c784; margin-bottom: 16px; }
        .overlay-msg { font-size: 22px; margin-bottom: 24px; }
        .overlay-stats { font-size: 16px; color: rgba(255,255,255,0.75); margin-bottom: 28px; line-height: 1.8; }

        .overlay-btn {
            padding: 14px 36px;
            font-size: 18px;
            font-weight: 600;
            background: rgba(129, 199, 132, 0.25);
            border: 2px solid rgba(129, 199, 132, 0.7);
            color: white;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .overlay-btn:hover { background: rgba(129, 199, 132, 0.4); transform: scale(1.05); }

        .ripple {
            position: absolute;
            border: 3px solid rgba(129, 199, 132, 0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 50;
            animation: rippleOut 0.7s ease-out forwards;
        }

        @keyframes rippleOut {
            0% { width: 0; height: 0; opacity: 1; }
            100% { width: 120px; height: 120px; opacity: 0; }
        }

        .found-burst {
            position: absolute;
            pointer-events: none;
            z-index: 60;
            font-size: 18px;
            animation: burstOut 0.8s ease-out forwards;
        }

        @keyframes burstOut {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--bx), var(--by)) scale(0.3); opacity: 0; }
        }

        @media (max-width: 768px) {
            .checklist { width: 180px; padding: 12px; }
            .cl-item { padding: 6px; }
            .hud-value { font-size: 22px; }
        }
    </style>
</head>
<body>
    <div class="game-wrap">
        <canvas id="scene"></canvas>

        <div class="hud">
            <div class="hud-box">
                <div class="hud-label">Found</div>
                <div class="hud-value" id="scoreVal">0/10</div>
            </div>
            <div class="hud-box">
                <div class="hud-label">Time</div>
                <div class="hud-value" id="timeVal">0:00</div>
            </div>
        </div>

        <div class="touch-indicator" id="touchInd">Multi-touch active</div>

        <div class="checklist">
            <div class="checklist-title">Find These Animals</div>
            <div id="clList"></div>
        </div>

        <div class="btn-row">
            <button class="btn btn-hint" id="hintBtn">Hint (3)</button>
            <button class="btn btn-back" onclick="location.href='../index.html'">Menu</button>
        </div>

        <div class="overlay" id="winOverlay">
            <div class="overlay-box">
                <div class="overlay-title">Well Done!</div>
                <div class="overlay-msg">All animals found!</div>
                <div class="overlay-stats" id="winStats"></div>
                <button class="overlay-btn" onclick="location.reload()">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        const cvs = document.getElementById('scene');
        const ctx = cvs.getContext('2d');
        let W, H;

        function resize() {
            W = cvs.width = window.innerWidth;
            H = cvs.height = window.innerHeight;
            if (jungleLayers.length) rebuildJungle();
        }

        window.addEventListener('resize', resize);
        resize();

        const ANIMAL_DEFS = [
            { icon: '\u{1F98A}', name: 'Fox' },
            { icon: '\u{1F43B}', name: 'Bear' },
            { icon: '\u{1F98C}', name: 'Deer' },
            { icon: '\u{1F989}', name: 'Owl' },
            { icon: '\u{1F99D}', name: 'Raccoon' },
            { icon: '\u{1F43F}\u{FE0F}', name: 'Squirrel' },
            { icon: '\u{1F994}', name: 'Hedgehog' },
            { icon: '\u{1F407}', name: 'Rabbit' },
            { icon: '\u{1F985}', name: 'Eagle' },
            { icon: '\u{1F98E}', name: 'Lizard' }
        ];

        let hiddenAnimals = [];
        let score = 0;
        let hints = 3;
        let elapsed = 0;
        let timer = null;
        let jungleLayers = [];

        function placeAnimals() {
            const margin = 80;
            const minDist = 90;
            hiddenAnimals = [];

            ANIMAL_DEFS.forEach(def => {
                let x, y, tries = 0;
                do {
                    x = margin + Math.random() * (W - margin * 2);
                    y = margin + Math.random() * (H - margin * 2);
                    tries++;
                } while (tries < 200 && hiddenAnimals.some(a => Math.hypot(a.x - x, a.y - y) < minDist));

                hiddenAnimals.push({
                    ...def,
                    x, y,
                    size: 36 + Math.random() * 20,
                    found: false,
                    phase: Math.random() * Math.PI * 2,
                    revealScale: 0
                });
            });
        }

        function rebuildJungle() {
            jungleLayers = [];
            for (let i = 0; i < 60; i++) {
                jungleLayers.push({
                    x: Math.random() * W,
                    y: Math.random() * H,
                    r: 15 + Math.random() * 50,
                    hue: 100 + Math.random() * 60,
                    alpha: 0.1 + Math.random() * 0.25,
                    speed: 0.3 + Math.random() * 0.7,
                    phase: Math.random() * Math.PI * 2
                });
            }
        }

        function buildChecklist() {
            const el = document.getElementById('clList');
            el.innerHTML = '';
            ANIMAL_DEFS.forEach((a, i) => {
                const item = document.createElement('div');
                item.className = 'cl-item';
                item.id = 'cl-' + i;
                item.innerHTML = '<span class="cl-icon">' + a.icon + '</span><span class="cl-name">' + a.name + '</span>';
                el.appendChild(item);
            });
        }

        function startTimer() {
            timer = setInterval(() => {
                elapsed++;
                const m = Math.floor(elapsed / 60);
                const s = elapsed % 60;
                document.getElementById('timeVal').textContent = m + ':' + (s < 10 ? '0' : '') + s;
            }, 1000);
        }

        function drawScene(now) {
            ctx.fillStyle = '#071a10';
            ctx.fillRect(0, 0, W, H);

            const g = ctx.createRadialGradient(W * 0.5, H * 0.3, 0, W * 0.5, H * 0.3, W * 0.7);
            g.addColorStop(0, 'rgba(27, 94, 32, 0.25)');
            g.addColorStop(1, 'rgba(5, 24, 16, 0)');
            ctx.fillStyle = g;
            ctx.fillRect(0, 0, W, H);

            const t = now * 0.001;
            jungleLayers.forEach(l => {
                const ox = Math.sin(t * l.speed + l.phase) * 8;
                const oy = Math.cos(t * l.speed * 0.7 + l.phase) * 5;
                ctx.beginPath();
                ctx.arc(l.x + ox, l.y + oy, l.r, 0, Math.PI * 2);
                ctx.fillStyle = 'hsla(' + l.hue + ', 50%, 20%, ' + l.alpha + ')';
                ctx.fill();
            });

            ctx.strokeStyle = 'rgba(56, 142, 60, 0.12)';
            ctx.lineWidth = 2;
            for (let i = 0; i < 40; i++) {
                const bx = (i * 67 + 13) % W;
                const swayOff = Math.sin(t * 0.5 + i) * 15;
                ctx.beginPath();
                ctx.moveTo(bx, H);
                ctx.quadraticCurveTo(bx + swayOff, H - 120 - (i % 5) * 40, bx + swayOff * 0.5, H - 200 - (i % 3) * 80);
                ctx.stroke();
            }

            hiddenAnimals.forEach(a => {
                ctx.save();
                ctx.font = a.size + 'px serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                if (a.found) {
                    a.revealScale = Math.min(1, a.revealScale + 0.06);
                    const s = 0.5 + a.revealScale * 0.5;
                    ctx.globalAlpha = 1;
                    ctx.translate(a.x, a.y);
                    ctx.scale(s, s);
                    ctx.fillText(a.icon, 0, 0);

                    ctx.strokeStyle = 'rgba(129, 199, 132, ' + (0.6 * (1 - a.revealScale)) + ')';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(0, 0, a.size * 0.8, 0, Math.PI * 2);
                    ctx.stroke();
                } else {
                    a.phase += 0.015;
                    const pulse = Math.sin(a.phase) * 0.12 + 0.18;
                    ctx.globalAlpha = pulse;
                    ctx.translate(a.x, a.y);
                    ctx.fillText(a.icon, 0, 0);
                }

                ctx.restore();
            });
        }

        let hintCircle = null;

        function drawHint(now) {
            if (!hintCircle) return;
            const age = now - hintCircle.start;
            if (age > 3000) { hintCircle = null; return; }
            const progress = age / 3000;
            const alpha = 1 - progress;
            const dashOffset = now * 0.005;

            ctx.save();
            ctx.strokeStyle = 'rgba(255, 193, 7, ' + (alpha * 0.8) + ')';
            ctx.lineWidth = 3;
            ctx.setLineDash([8, 6]);
            ctx.lineDashOffset = dashOffset;
            ctx.beginPath();
            ctx.arc(hintCircle.x, hintCircle.y, hintCircle.r, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.restore();
        }

        function loop(now) {
            drawScene(now);
            drawHint(now);
            requestAnimationFrame(loop);
        }

        function hitTest(px, py) {
            for (let i = 0; i < hiddenAnimals.length; i++) {
                const a = hiddenAnimals[i];
                if (a.found) continue;
                if (Math.hypot(px - a.x, py - a.y) < a.size * 0.9) return i;
            }
            return -1;
        }

        function revealAnimal(idx, tx, ty) {
            const a = hiddenAnimals[idx];
            a.found = true;
            score++;
            document.getElementById('scoreVal').textContent = score + '/' + ANIMAL_DEFS.length;
            document.getElementById('cl-' + idx).classList.add('found');
            spawnBurst(a.x, a.y);
            playChime();
            if (score === ANIMAL_DEFS.length) endGame();
        }

        function spawnRipple(x, y) {
            const r = document.createElement('div');
            r.className = 'ripple';
            r.style.left = (x - 0) + 'px';
            r.style.top = (y - 0) + 'px';
            r.style.marginLeft = '-60px';
            r.style.marginTop = '-60px';
            document.querySelector('.game-wrap').appendChild(r);
            r.addEventListener('animationend', () => r.remove());
        }

        function spawnBurst(x, y) {
            const emojis = ['\u2728', '\u{1F31F}', '\u2B50', '\u{1F33F}', '\u{1F343}'];
            for (let i = 0; i < 12; i++) {
                const el = document.createElement('div');
                el.className = 'found-burst';
                el.textContent = emojis[i % emojis.length];
                el.style.left = x + 'px';
                el.style.top = y + 'px';
                const angle = (i / 12) * Math.PI * 2;
                const dist = 60 + Math.random() * 60;
                el.style.setProperty('--bx', (Math.cos(angle) * dist) + 'px');
                el.style.setProperty('--by', (Math.sin(angle) * dist) + 'px');
                document.querySelector('.game-wrap').appendChild(el);
                el.addEventListener('animationend', () => el.remove());
            }
        }

        function playChime() {
            try {
                const ac = new (window.AudioContext || window.webkitAudioContext)();
                [523.25, 659.25, 783.99].forEach((freq, i) => {
                    const o = ac.createOscillator();
                    const g = ac.createGain();
                    o.connect(g);
                    g.connect(ac.destination);
                    o.frequency.value = freq;
                    o.type = 'sine';
                    const t0 = ac.currentTime + i * 0.08;
                    g.gain.setValueAtTime(0.2, t0);
                    g.gain.exponentialRampToValueAtTime(0.001, t0 + 0.3);
                    o.start(t0);
                    o.stop(t0 + 0.3);
                });
            } catch (_) {}
        }

        function endGame() {
            clearInterval(timer);
            setTimeout(() => {
                const m = Math.floor(elapsed / 60);
                const s = elapsed % 60;
                document.getElementById('winStats').innerHTML =
                    'Time: ' + m + ':' + (s < 10 ? '0' : '') + s + '<br>Hints used: ' + (3 - hints);
                document.getElementById('winOverlay').classList.add('show');
            }, 600);
        }

        function useHint() {
            if (hints <= 0) return;
            const remaining = hiddenAnimals.filter(a => !a.found);
            if (!remaining.length) return;
            const target = remaining[Math.floor(Math.random() * remaining.length)];
            hintCircle = { x: target.x, y: target.y, r: target.size + 25, start: performance.now() };
            hints--;
            const btn = document.getElementById('hintBtn');
            btn.textContent = hints > 0 ? 'Hint (' + hints + ')' : 'No Hints';
            if (hints <= 0) btn.disabled = true;
        }

        document.getElementById('hintBtn').addEventListener('click', useHint);

        const touchInd = document.getElementById('touchInd');
        const activeTouches = new Map();

        function updateTouchInd() {
            const n = activeTouches.size;
            touchInd.textContent = n + ' touch' + (n !== 1 ? 'es' : '') + ' active';
            touchInd.classList.toggle('visible', n > 1);
        }

        cvs.addEventListener('touchstart', e => {
            e.preventDefault();
            for (let i = 0; i < e.changedTouches.length; i++) {
                const t = e.changedTouches[i];
                activeTouches.set(t.identifier, true);
                const x = t.clientX, y = t.clientY;
                spawnRipple(x, y);
                const idx = hitTest(x, y);
                if (idx >= 0) revealAnimal(idx, x, y);
            }
            updateTouchInd();
        }, { passive: false });

        cvs.addEventListener('touchend', e => {
            for (let i = 0; i < e.changedTouches.length; i++) {
                activeTouches.delete(e.changedTouches[i].identifier);
            }
            updateTouchInd();
        });

        cvs.addEventListener('touchcancel', e => {
            for (let i = 0; i < e.changedTouches.length; i++) {
                activeTouches.delete(e.changedTouches[i].identifier);
            }
            updateTouchInd();
        });

        cvs.addEventListener('click', e => {
            const x = e.clientX, y = e.clientY;
            spawnRipple(x, y);
            const idx = hitTest(x, y);
            if (idx >= 0) revealAnimal(idx, x, y);
        });

        placeAnimals();
        rebuildJungle();
        buildChecklist();
        startTimer();
        requestAnimationFrame(loop);
    </script>
</body>
</html>
