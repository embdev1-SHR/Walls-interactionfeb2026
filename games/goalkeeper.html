<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ball Blocker Challenge</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;user-select:none}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  overflow:hidden;background:#1a472a;touch-action:none;
}
canvas{display:block;position:fixed;inset:0;z-index:0}

.hud{
  position:fixed;top:14px;left:50%;transform:translateX(-50%);
  display:flex;gap:12px;z-index:100;pointer-events:none;
}
.hud-box{
  background:rgba(255,255,255,.95);padding:10px 20px;border-radius:14px;
  box-shadow:0 6px 20px rgba(0,0,0,.15);text-align:center;min-width:80px;
}
.hud-label{font-size:11px;color:#888;text-transform:uppercase;font-weight:700;letter-spacing:1px}
.hud-val{font-size:28px;font-weight:700}
.hud-saves{color:#4CAF50}
.hud-missed{color:#F44336}
.hud-combo{color:#FFB300}
.hud-time{color:#1976D2}

.combo-popup{
  position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);
  font-size:56px;font-weight:900;color:#FFD700;
  text-shadow:3px 3px 8px rgba(0,0,0,.4);
  pointer-events:none;z-index:200;
  animation:comboIn .8s ease forwards;
}
@keyframes comboIn{
  0%{transform:translate(-50%,-50%) scale(0);opacity:0}
  40%{transform:translate(-50%,-50%) scale(1.3);opacity:1}
  100%{transform:translate(-50%,-50%) scale(1);opacity:0}
}

.start-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.75);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:500;backdrop-filter:blur(6px);
}
.start-overlay.hidden{display:none}
.start-title{font-size:clamp(36px,6vw,56px);font-weight:900;color:white;margin-bottom:12px;text-shadow:3px 3px 8px rgba(0,0,0,.5)}
.start-sub{font-size:clamp(14px,2vw,20px);color:rgba(255,255,255,.7);margin-bottom:32px;text-align:center;max-width:400px;line-height:1.5}
.start-btn{
  padding:18px 50px;font-size:clamp(20px,3vw,28px);font-weight:700;
  background:linear-gradient(135deg,#4CAF50,#2E7D32);color:white;
  border:none;border-radius:60px;cursor:pointer;
  box-shadow:0 8px 30px rgba(76,175,80,.4);
  transition:all .3s;touch-action:manipulation;-webkit-tap-highlight-color:transparent;
}
.start-btn:active{transform:scale(.95)}

.game-over-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.8);
  display:none;align-items:center;justify-content:center;
  z-index:500;backdrop-filter:blur(6px);
}
.game-over-overlay.show{display:flex}
.go-box{
  background:white;padding:40px 60px;border-radius:24px;
  box-shadow:0 20px 60px rgba(0,0,0,.3);text-align:center;
}
.go-box h2{font-size:42px;color:#F44336;margin-bottom:14px}
.go-box p{font-size:20px;color:#666;margin-bottom:24px}
.go-btn{
  padding:14px 40px;font-size:20px;font-weight:700;
  background:linear-gradient(135deg,#4CAF50,#2E7D32);color:white;
  border:none;border-radius:50px;cursor:pointer;
  transition:all .3s;margin:0 6px;
  touch-action:manipulation;-webkit-tap-highlight-color:transparent;
}
.go-btn:active{transform:scale(.93)}
.go-btn.menu{background:linear-gradient(135deg,#42A5F5,#1976D2)}

.bottom-bar{
  position:fixed;bottom:14px;left:50%;transform:translateX(-50%);
  z-index:100;pointer-events:auto;
}
.btn-back{
  padding:10px 24px;font-size:14px;font-weight:600;
  background:rgba(255,255,255,.9);color:#333;
  border:none;border-radius:50px;cursor:pointer;
  box-shadow:0 4px 16px rgba(0,0,0,.15);
  transition:all .3s;touch-action:manipulation;-webkit-tap-highlight-color:transparent;
}
.btn-back:active{transform:scale(.93)}

.tap-ring{
  position:fixed;pointer-events:none;z-index:150;
  border:3px solid rgba(76,175,80,.7);border-radius:50%;
  transform:translate(-50%,-50%) scale(0);
  animation:tapRing .5s ease forwards;
}
@keyframes tapRing{
  0%{width:0;height:0;opacity:1;transform:translate(-50%,-50%) scale(0)}
  100%{width:80px;height:80px;opacity:0;transform:translate(-50%,-50%) scale(1)}
}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<div class="hud" id="hud" style="display:none">
  <div class="hud-box">
    <div class="hud-label">Saves</div>
    <div class="hud-val hud-saves" id="savesVal">0</div>
  </div>
  <div class="hud-box">
    <div class="hud-label">Missed</div>
    <div class="hud-val hud-missed" id="missedVal">0</div>
  </div>
  <div class="hud-box">
    <div class="hud-label">Combo</div>
    <div class="hud-val hud-combo" id="comboVal">0</div>
  </div>
  <div class="hud-box">
    <div class="hud-label">Time</div>
    <div class="hud-val hud-time" id="timeVal">60</div>
  </div>
</div>

<div class="start-overlay" id="startOverlay">
  <div class="start-title">Ball Blocker</div>
  <div class="start-sub">Tap the incoming balls before they reach the goal! Quick reflexes will save you!</div>
  <button class="start-btn" id="startBtn">Start Now</button>
</div>

<div class="game-over-overlay" id="gameOverOverlay">
  <div class="go-box">
    <h2>Game Over!</h2>
    <p id="goStats">Saves: 0 | Missed: 10</p>
    <button class="go-btn" id="restartBtn">Play Again</button>
    <button class="go-btn menu" id="goMenuBtn">Menu</button>
  </div>
</div>

<div class="bottom-bar">
  <button class="btn-back" id="backBtn">Back to Menu</button>
</div>

<script>
var cvs = document.getElementById('gameCanvas');
var ctx = cvs.getContext('2d');
var W, H;

var saves = 0, missed = 0, combo = 0, timeLeft = 60;
var gameActive = false, balls = [], particles = [];
var difficulty = 1, spawnInterval = 1800;
var lastSpawn = 0, clockTimer = null;
var goalY, goalH;

function resize() {
  W = cvs.width = window.innerWidth;
  H = cvs.height = window.innerHeight;
  goalY = H * 0.75;
  goalH = H * 0.12;
}
window.addEventListener('resize', resize);
resize();

var BALL_COLORS = ['#F44336','#E91E63','#FF9800','#FFEB3B','#4CAF50','#2196F3','#9C27B0'];

function Ball() {
  var side = Math.floor(Math.random() * 3);
  if (side === 0) {
    this.x = Math.random() * W;
    this.y = -30;
  } else if (side === 1) {
    this.x = -30;
    this.y = H * 0.1 + Math.random() * H * 0.4;
  } else {
    this.x = W + 30;
    this.y = H * 0.1 + Math.random() * H * 0.4;
  }
  var targetX = W * 0.15 + Math.random() * W * 0.7;
  var targetY = goalY + Math.random() * goalH;
  var dx = targetX - this.x, dy = targetY - this.y;
  var dist = Math.hypot(dx, dy);
  var speed = 1.5 + difficulty * 0.3 + Math.random() * 0.8;
  this.vx = (dx / dist) * speed;
  this.vy = (dy / dist) * speed;
  this.r = 18 + Math.random() * 10;
  this.color = BALL_COLORS[Math.floor(Math.random() * BALL_COLORS.length)];
  this.rotation = 0;
  this.rotSpeed = (Math.random() - 0.5) * 0.15;
  this.alive = true;
  this.blocked = false;
  this.alpha = 1;
}

Ball.prototype.update = function() {
  if (this.blocked) {
    this.vy += 0.4;
    this.alpha -= 0.04;
    this.x += this.vx;
    this.y += this.vy;
    if (this.alpha <= 0) this.alive = false;
  } else {
    this.x += this.vx;
    this.y += this.vy;
    if (this.y >= goalY + goalH * 0.5) {
      this.alive = false;
      missed++;
      combo = 0;
      document.getElementById('missedVal').textContent = missed;
      document.getElementById('comboVal').textContent = combo;
      spawnMissParticles(this.x, this.y);
      if (missed >= 10) endGame();
    }
  }
  this.rotation += this.rotSpeed;
};

Ball.prototype.draw = function() {
  ctx.save();
  ctx.globalAlpha = this.alpha;
  ctx.translate(this.x, this.y);
  ctx.rotate(this.rotation);

  ctx.beginPath();
  ctx.arc(0, 0, this.r, 0, Math.PI * 2);
  ctx.fillStyle = this.color;
  ctx.fill();
  ctx.strokeStyle = 'rgba(0,0,0,.2)';
  ctx.lineWidth = 2;
  ctx.stroke();

  ctx.strokeStyle = 'rgba(255,255,255,.35)';
  ctx.lineWidth = 1.5;
  ctx.beginPath(); ctx.moveTo(-this.r * 0.6, -this.r * 0.3); ctx.lineTo(this.r * 0.6, -this.r * 0.3); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(-this.r * 0.4, this.r * 0.3); ctx.lineTo(this.r * 0.4, this.r * 0.3); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(0, -this.r); ctx.lineTo(0, this.r); ctx.stroke();

  ctx.beginPath();
  ctx.arc(-this.r * 0.25, -this.r * 0.25, this.r * 0.2, 0, Math.PI * 2);
  ctx.fillStyle = 'rgba(255,255,255,.3)';
  ctx.fill();

  ctx.restore();
};

Ball.prototype.contains = function(px, py) {
  return Math.hypot(px - this.x, py - this.y) < this.r + 20;
};

function Particle(x, y, color, vx, vy) {
  this.x = x; this.y = y; this.color = color;
  this.vx = vx; this.vy = vy;
  this.r = 2 + Math.random() * 4;
  this.alpha = 1;
  this.gravity = 0.15;
}
Particle.prototype.update = function() {
  this.vy += this.gravity; this.x += this.vx; this.y += this.vy; this.alpha -= 0.025;
};
Particle.prototype.draw = function() {
  ctx.save(); ctx.globalAlpha = this.alpha; ctx.fillStyle = this.color;
  ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2); ctx.fill(); ctx.restore();
};
Particle.prototype.isDead = function() { return this.alpha <= 0; };

function spawnSaveParticles(x, y, color) {
  for (var i = 0; i < 18; i++) {
    var a = Math.random() * Math.PI * 2, sp = 2 + Math.random() * 5;
    particles.push(new Particle(x, y, color, Math.cos(a) * sp, Math.sin(a) * sp - 2));
  }
  for (var i = 0; i < 6; i++) {
    var a2 = Math.random() * Math.PI * 2, sp2 = 3 + Math.random() * 3;
    particles.push(new Particle(x, y, '#FFD700', Math.cos(a2) * sp2, Math.sin(a2) * sp2 - 3));
  }
}

function spawnMissParticles(x, y) {
  for (var i = 0; i < 10; i++) {
    var a = Math.random() * Math.PI * 2, sp = 1 + Math.random() * 3;
    particles.push(new Particle(x, y, '#F44336', Math.cos(a) * sp, Math.sin(a) * sp));
  }
}

function spawnTapRing(x, y) {
  var ring = document.createElement('div');
  ring.className = 'tap-ring';
  ring.style.left = x + 'px';
  ring.style.top = y + 'px';
  document.body.appendChild(ring);
  ring.addEventListener('animationend', function() { ring.remove(); });
}

function handleTap(x, y) {
  if (!gameActive) return;
  spawnTapRing(x, y);
  var hit = false;
  for (var i = 0; i < balls.length; i++) {
    var b = balls[i];
    if (!b.blocked && b.alive && b.contains(x, y)) {
      b.blocked = true;
      b.vx = (Math.random() - 0.5) * 8;
      b.vy = -6 - Math.random() * 4;
      saves++;
      combo++;
      hit = true;
      spawnSaveParticles(b.x, b.y, b.color);
      document.getElementById('savesVal').textContent = saves;
      document.getElementById('comboVal').textContent = combo;
      if (combo > 0 && combo % 3 === 0) showCombo();
      playTapSound();
      break;
    }
  }
  if (!hit) { combo = 0; document.getElementById('comboVal').textContent = combo; }
}

function playTapSound() {
  try {
    var ac = new (window.AudioContext || window.webkitAudioContext)();
    var o = ac.createOscillator(), g = ac.createGain();
    o.connect(g); g.connect(ac.destination);
    o.type = 'sine'; o.frequency.value = 600 + Math.random() * 200;
    var now = ac.currentTime;
    g.gain.setValueAtTime(0.15, now);
    g.gain.exponentialRampToValueAtTime(0.001, now + 0.15);
    o.start(now); o.stop(now + 0.15);
  } catch (e) {}
}

function showCombo() {
  var msgs = ['Nice!', 'Great!', 'Amazing!', 'Fantastic!', 'Unstoppable!'];
  var el = document.createElement('div');
  el.className = 'combo-popup';
  el.textContent = msgs[Math.min(Math.floor(combo / 3) - 1, msgs.length - 1)] + ' ' + combo + 'x';
  document.body.appendChild(el);
  setTimeout(function() { el.remove(); }, 800);
}

function drawField() {
  var skyGrad = ctx.createLinearGradient(0, 0, 0, H * 0.6);
  skyGrad.addColorStop(0, '#87CEEB');
  skyGrad.addColorStop(1, '#B8E6FF');
  ctx.fillStyle = skyGrad;
  ctx.fillRect(0, 0, W, H * 0.6);

  var fieldGrad = ctx.createLinearGradient(0, H * 0.55, 0, H);
  fieldGrad.addColorStop(0, '#4CAF50');
  fieldGrad.addColorStop(0.4, '#388E3C');
  fieldGrad.addColorStop(1, '#2E7D32');
  ctx.fillStyle = fieldGrad;
  ctx.fillRect(0, H * 0.55, W, H * 0.45);

  for (var i = 0; i < 12; i++) {
    var sx = (i / 12) * W;
    ctx.fillStyle = i % 2 === 0 ? 'rgba(255,255,255,.03)' : 'rgba(0,0,0,.02)';
    ctx.fillRect(sx, H * 0.55, W / 12, H * 0.45);
  }

  ctx.strokeStyle = 'rgba(255,255,255,.4)';
  ctx.lineWidth = 3;
  var gLeft = W * 0.15, gRight = W * 0.85, gTop = goalY, gBot = goalY + goalH;
  ctx.strokeRect(gLeft, gTop, gRight - gLeft, goalH);

  ctx.fillStyle = 'rgba(200,200,200,.12)';
  ctx.fillRect(gLeft, gTop, gRight - gLeft, goalH);

  ctx.strokeStyle = 'rgba(255,255,255,.1)';
  ctx.lineWidth = 1;
  var netSpacing = 15;
  for (var nx = gLeft; nx <= gRight; nx += netSpacing) {
    ctx.beginPath(); ctx.moveTo(nx, gTop); ctx.lineTo(nx, gBot); ctx.stroke();
  }
  for (var ny = gTop; ny <= gBot; ny += netSpacing) {
    ctx.beginPath(); ctx.moveTo(gLeft, ny); ctx.lineTo(gRight, ny); ctx.stroke();
  }

  ctx.fillStyle = 'white';
  ctx.fillRect(gLeft - 4, gTop, 4, goalH);
  ctx.fillRect(gRight, gTop, 4, goalH);
  ctx.fillRect(gLeft - 4, gTop - 4, gRight - gLeft + 8, 4);
}

function gameLoop() {
  ctx.clearRect(0, 0, W, H);
  drawField();

  if (gameActive) {
    var now = Date.now();
    if (now - lastSpawn > spawnInterval) {
      balls.push(new Ball());
      lastSpawn = now;
      if (saves > 0 && saves % 8 === 0 && difficulty < 10) {
        difficulty++;
        spawnInterval = Math.max(600, spawnInterval - 120);
      }
    }
  }

  for (var i = balls.length - 1; i >= 0; i--) {
    balls[i].update();
    balls[i].draw();
    if (!balls[i].alive) balls.splice(i, 1);
  }
  for (var i = particles.length - 1; i >= 0; i--) {
    particles[i].update();
    particles[i].draw();
    if (particles[i].isDead()) particles.splice(i, 1);
  }

  requestAnimationFrame(gameLoop);
}

function startGame() {
  document.getElementById('startOverlay').classList.add('hidden');
  document.getElementById('hud').style.display = 'flex';
  gameActive = true;
  lastSpawn = Date.now();
  clockTimer = setInterval(function() {
    if (!gameActive) { clearInterval(clockTimer); return; }
    timeLeft--;
    document.getElementById('timeVal').textContent = timeLeft;
    if (timeLeft <= 0) { clearInterval(clockTimer); endGame(); }
  }, 1000);
}

function endGame() {
  gameActive = false;
  if (clockTimer) clearInterval(clockTimer);
  document.getElementById('goStats').textContent = 'Saves: ' + saves + ' | Missed: ' + missed;
  document.getElementById('gameOverOverlay').classList.add('show');
}

function restartGame() {
  saves = 0; missed = 0; combo = 0; timeLeft = 60;
  difficulty = 1; spawnInterval = 1800;
  balls.length = 0; particles.length = 0;
  document.getElementById('savesVal').textContent = '0';
  document.getElementById('missedVal').textContent = '0';
  document.getElementById('comboVal').textContent = '0';
  document.getElementById('timeVal').textContent = '60';
  document.getElementById('gameOverOverlay').classList.remove('show');
  gameActive = true;
  lastSpawn = Date.now();
  clockTimer = setInterval(function() {
    if (!gameActive) { clearInterval(clockTimer); return; }
    timeLeft--;
    document.getElementById('timeVal').textContent = timeLeft;
    if (timeLeft <= 0) { clearInterval(clockTimer); endGame(); }
  }, 1000);
}

cvs.addEventListener('pointerdown', function(e) {
  e.preventDefault();
  handleTap(e.clientX, e.clientY);
});

function addTouchBtn(id, fn) {
  var el = document.getElementById(id);
  if (!el) return;
  el.addEventListener('click', function(e) { if (!(e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents)) fn(); });
  el.addEventListener('touchend', function(e) { e.preventDefault(); e.stopPropagation(); fn(); });
}

addTouchBtn('startBtn', startGame);
addTouchBtn('restartBtn', restartGame);
addTouchBtn('goMenuBtn', function() { location.href = '../index.html'; });
addTouchBtn('backBtn', function() { location.href = '../index.html'; });

gameLoop();
</script>
</body>
</html>
