<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Detective Wall - Interactive Investigation</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Courier New', monospace;
  background: #1a1a2e;
  overflow: hidden;
  color: #fff;
  -webkit-user-select: none;
  user-select: none;
}

/* VERTICAL MENU */
.vertical-menu {
  position: fixed;
  left: 0;
  top: 0;
  width: 280px;
  height: 100vh;
  background: linear-gradient(180deg, #16213e 0%, #0f1419 100%);
  border-right: 3px solid #e94560;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  box-shadow: 4px 0 20px rgba(233, 69, 96, 0.3);
}

.vertical-menu.hidden {
  transform: translateX(-280px);
}

.menu-header {
  padding: 25px 20px;
  background: rgba(233, 69, 96, 0.1);
  border-bottom: 2px solid #e94560;
  text-align: center;
}

.menu-logo {
  font-size: 48px;
  margin-bottom: 10px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

.menu-title {
  font-size: 20px;
  color: #e94560;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 2px;
  text-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
}

.menu-subtitle {
  font-size: 11px;
  color: #aaa;
  margin-top: 5px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.menu-cases {
  flex: 1;
  overflow-y: auto;
  padding: 12px 10px;
}

.menu-cases::-webkit-scrollbar {
  width: 6px;
}

.menu-cases::-webkit-scrollbar-thumb {
  background: #e94560;
  border-radius: 3px;
}

.case-card {
  background: rgba(22, 33, 62, 0.6);
  border: 2px solid #533a71;
  border-radius: 8px;
  padding: 10px 12px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.case-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(233, 69, 96, 0.2), transparent);
  transition: left 0.5s;
}

.case-card:hover::before {
  left: 100%;
}

.case-card:hover {
  border-color: #e94560;
  transform: translateX(3px);
  box-shadow: 0 3px 10px rgba(233, 69, 96, 0.3);
}

.case-card.active {
  background: rgba(233, 69, 96, 0.2);
  border-color: #e94560;
  box-shadow: 0 0 20px rgba(233, 69, 96, 0.4);
}

.case-number {
  font-size: 9px;
  color: #e94560;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin: 0;
}

.case-name {
  font-size: 13px;
  font-weight: bold;
  color: #fff;
  margin: 0;
  line-height: 1.3;
}

.case-difficulty {
  font-size: 10px;
  color: #aaa;
  display: flex;
  align-items: center;
  gap: 4px;
  margin: 0;
}

.difficulty-stars {
  color: #ffd700;
  font-size: 10px;
}

.menu-footer {
  padding: 15px;
  border-top: 2px solid #533a71;
  background: rgba(15, 20, 25, 0.8);
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.back-btn {
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, #e94560 0%, #c93a50 100%);
  border: none;
  border-radius: 8px;
  color: #fff;
  font-size: 14px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
}

.back-btn.global-back {
  background: linear-gradient(135deg, #533a71 0%, #3a2757 100%);
  box-shadow: 0 4px 15px rgba(83, 58, 113, 0.3);
}

.back-btn.global-back:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(83, 58, 113, 0.5);
}

.back-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(233, 69, 96, 0.5);
}

.back-btn:active {
  transform: translateY(0);
}

.menu-toggle {
  position: fixed;
  left: 290px;
  top: 20px;
  width: 45px;
  height: 45px;
  background: linear-gradient(135deg, #e94560 0%, #c93a50 100%);
  border: 2px solid #fff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  cursor: pointer;
  z-index: 999;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(233, 69, 96, 0.5);
}

.menu-toggle:hover {
  transform: scale(1.1) rotate(180deg);
}

.menu-toggle.menu-hidden {
  left: 10px;
}

/* DETECTIVE GUIDE */
.detective-guide {
  position: fixed;
  bottom: 100px;
  left: 320px;
  z-index: 900;
  transition: all 0.4s ease;
}

.detective-guide.menu-hidden {
  left: 40px;
}

.detective-avatar {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 45px;
  border: 3px solid #fff;
  box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
  cursor: pointer;
  animation: bounce 2s ease-in-out infinite;
  position: relative;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.detective-avatar::after {
  content: '';
  position: absolute;
  top: -5px;
  right: -5px;
  width: 20px;
  height: 20px;
  background: #e94560;
  border-radius: 50%;
  border: 2px solid #fff;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.2); opacity: 0.7; }
}

.chat-bubble {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%) translateY(-15px);
  background: linear-gradient(135deg, #16213e 0%, #0f1419 100%);
  border: 2px solid #e94560;
  border-radius: 15px;
  padding: 15px 20px;
  max-width: 280px;
  min-width: 200px;
  box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s ease;
}

.chat-bubble.show {
  opacity: 1;
  transform: translateX(-50%) translateY(-25px);
}

.chat-bubble::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-top: 10px solid #e94560;
}

.chat-text {
  font-size: 13px;
  color: #fff;
  line-height: 1.5;
  margin-bottom: 8px;
}

.chat-hint {
  font-size: 11px;
  color: #ffd700;
  font-style: italic;
}

/* GAME CANVAS */
.game-container {
  position: fixed;
  left: 280px;
  top: 0;
  right: 0;
  bottom: 0;
  background: #0f1419;
  transition: left 0.4s ease;
  display: none;
}

.game-container.active {
  display: block;
}

.game-container.menu-hidden {
  left: 0;
}

.investigation-wall {
  position: relative;
  width: 100%;
  height: 100%;
  background: 
    repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,.03) 2px, rgba(255,255,255,.03) 4px),
    repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(255,255,255,.03) 2px, rgba(255,255,255,.03) 4px),
    radial-gradient(circle at 30% 50%, rgba(233, 69, 96, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 70% 50%, rgba(83, 58, 113, 0.1) 0%, transparent 50%),
    #1a1a2e;
  overflow: hidden;
}

/* STRING CONNECTIONS */
.string-canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
}

/* EVIDENCE ITEMS */
.evidence-item {
  position: absolute;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 10;
}

.evidence-item.locked {
  opacity: 0.3;
  filter: grayscale(100%);
  cursor: not-allowed;
  pointer-events: none;
}

.evidence-item.found {
  animation: foundPulse 0.6s ease;
}

@keyframes foundPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.3); }
}

.evidence-item:not(.locked):hover {
  transform: scale(1.2) rotate(5deg);
  filter: drop-shadow(0 0 15px rgba(233, 69, 96, 0.8));
}

.evidence-photo {
  width: 120px;
  height: 120px;
  background: rgba(22, 33, 62, 0.9);
  border: 3px solid #533a71;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 60px;
  position: relative;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  transform: rotate(-3deg);
}

.evidence-photo::before {
  content: '';
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 20px;
  height: 3px;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 2px;
}

.evidence-label {
  position: absolute;
  bottom: -25px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(233, 69, 96, 0.9);
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 11px;
  white-space: nowrap;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.evidence-item.locked .evidence-photo {
  border-color: #444;
  background: rgba(30, 30, 40, 0.8);
}

.evidence-item.locked .evidence-label {
  background: rgba(100, 100, 100, 0.9);
}

.evidence-item.wrong {
  animation: wrongShake 0.5s ease;
}

@keyframes wrongShake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

.evidence-item.wrong .evidence-photo {
  border-color: #dc2626;
  background: rgba(220, 38, 38, 0.2);
}

.evidence-item.wrong .evidence-label {
  background: rgba(220, 38, 38, 0.9);
}

.wrong-x {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 60px;
  color: #dc2626;
  font-weight: bold;
  animation: wrongPop 0.5s ease;
  pointer-events: none;
  z-index: 100;
}

@keyframes wrongPop {
  0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); opacity: 0; }
  50% { transform: translate(-50%, -50%) scale(1.3) rotate(180deg); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(1) rotate(360deg); opacity: 1; }
}

.evidence-item.found .evidence-photo {
  border-color: #ffd700;
  background: rgba(83, 58, 113, 0.9);
  animation: glow 2s ease-in-out infinite;
}

@keyframes glow {
  0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
  50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
}

.evidence-item.wrong {
  animation: wrongShake 0.5s ease;
}

@keyframes wrongShake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

.evidence-item.wrong .evidence-photo {
  border-color: #dc2626;
  background: rgba(220, 38, 38, 0.2);
}

.evidence-item.wrong .evidence-label {
  background: rgba(220, 38, 38, 0.9);
}

.wrong-x {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 60px;
  color: #dc2626;
  font-weight: bold;
  animation: wrongPop 0.5s ease;
  pointer-events: none;
  z-index: 100;
}

@keyframes wrongPop {
  0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); opacity: 0; }
  50% { transform: translate(-50%, -50%) scale(1.3) rotate(180deg); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(1) rotate(360deg); opacity: 1; }
}

.evidence-popup.wrong {
  border-color: #dc2626;
}

.evidence-popup.wrong .popup-title {
  color: #dc2626;
}

.evidence-popup.wrong .popup-clue {
  background: rgba(220, 38, 38, 0.1);
  border-left-color: #dc2626;
}

.lock-icon {
  position: absolute;
  top: -10px;
  right: -10px;
  width: 30px;
  height: 30px;
  background: #e94560;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  border: 2px solid #fff;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

/* EVIDENCE DETAIL POPUP */
.evidence-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  background: linear-gradient(135deg, #16213e 0%, #0f1419 100%);
  border: 3px solid #e94560;
  border-radius: 20px;
  padding: 30px;
  max-width: 450px;
  width: 90%;
  z-index: 2000;
  box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
  transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.evidence-popup.show {
  transform: translate(-50%, -50%) scale(1);
}

.popup-emoji {
  font-size: 80px;
  text-align: center;
  margin-bottom: 15px;
  animation: popRotate 0.6s ease;
}

@keyframes popRotate {
  0% { transform: rotate(0deg) scale(0); }
  50% { transform: rotate(180deg) scale(1.2); }
  100% { transform: rotate(360deg) scale(1); }
}

.popup-title {
  font-size: 24px;
  color: #e94560;
  text-align: center;
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.popup-description {
  font-size: 14px;
  color: #ccc;
  text-align: center;
  line-height: 1.6;
  margin-bottom: 20px;
}

.popup-clue {
  background: rgba(233, 69, 96, 0.1);
  border-left: 3px solid #ffd700;
  padding: 12px;
  border-radius: 5px;
  margin-bottom: 20px;
}

.popup-clue-title {
  font-size: 12px;
  color: #ffd700;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 5px;
}

.popup-clue-text {
  font-size: 13px;
  color: #fff;
  font-style: italic;
}

.popup-btn {
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, #e94560 0%, #c93a50 100%);
  border: none;
  border-radius: 8px;
  color: #fff;
  font-size: 14px;
  font-weight: bold;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
}

.popup-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(233, 69, 96, 0.5);
}

.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 1999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.popup-overlay.show {
  opacity: 1;
  pointer-events: all;
}

/* PROGRESS HUD */
.progress-hud {
  position: fixed;
  top: 20px;
  right: 20px;
  background: linear-gradient(135deg, #16213e 0%, #0f1419 100%);
  border: 2px solid #e94560;
  border-radius: 15px;
  padding: 15px 20px;
  z-index: 800;
  min-width: 200px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
}

.hud-title {
  font-size: 11px;
  color: #e94560;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}

.hud-progress {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
}

.progress-dot {
  width: 18px;
  height: 18px;
  background: rgba(100, 100, 100, 0.3);
  border: 2px solid #533a71;
  border-radius: 50%;
  transition: all 0.3s ease;
}

.progress-dot.found {
  background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
  border-color: #ffd700;
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
  animation: dotPulse 0.6s ease;
}

@keyframes dotPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.4); }
}

.hud-stats {
  font-size: 13px;
  color: #ccc;
  display: flex;
  justify-content: space-between;
}

.stat-value {
  color: #ffd700;
  font-weight: bold;
}

/* VICTORY SCREEN */
.victory-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.95);
  z-index: 3000;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s ease;
}

.victory-screen.show {
  opacity: 1;
  pointer-events: all;
}

.victory-content {
  text-align: center;
  max-width: 500px;
  padding: 40px;
  background: linear-gradient(135deg, #16213e 0%, #0f1419 100%);
  border: 3px solid #ffd700;
  border-radius: 20px;
  box-shadow: 0 10px 50px rgba(255, 215, 0, 0.3);
  animation: victoryPop 0.6s ease;
}

@keyframes victoryPop {
  0% { transform: scale(0) rotate(-180deg); }
  50% { transform: scale(1.1) rotate(10deg); }
  100% { transform: scale(1) rotate(0deg); }
}

.victory-emoji {
  font-size: 100px;
  margin-bottom: 20px;
  animation: victoryFloat 2s ease-in-out infinite;
}

@keyframes victoryFloat {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

.victory-title {
  font-size: 36px;
  color: #ffd700;
  text-transform: uppercase;
  letter-spacing: 3px;
  margin-bottom: 15px;
  text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
}

.victory-message {
  font-size: 16px;
  color: #ccc;
  margin-bottom: 25px;
  line-height: 1.6;
}

.victory-stats {
  background: rgba(233, 69, 96, 0.1);
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 25px;
}

.victory-stat {
  font-size: 14px;
  color: #fff;
  margin: 5px 0;
}

.victory-buttons {
  display: flex;
  gap: 15px;
}

.victory-btn {
  flex: 1;
  padding: 12px;
  background: linear-gradient(135deg, #e94560 0%, #c93a50 100%);
  border: none;
  border-radius: 8px;
  color: #fff;
  font-size: 14px;
  font-weight: bold;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
}

.victory-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(233, 69, 96, 0.5);
}

.victory-btn.secondary {
  background: linear-gradient(135deg, #533a71 0%, #3a2757 100%);
}

.victory-btn.secondary:hover {
  box-shadow: 0 5px 20px rgba(83, 58, 113, 0.5);
}

/* PARTICLE EFFECTS */
.particle {
  position: absolute;
  pointer-events: none;
  z-index: 5;
  animation: particleFall 3s linear forwards;
}

@keyframes particleFall {
  to {
    transform: translateY(100vh) rotate(360deg);
    opacity: 0;
  }
}

/* WELCOME SCREEN */
.welcome-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #16213e 0%, #0f1419 100%);
  z-index: 5000;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.5s ease;
}

.welcome-screen.hidden {
  opacity: 0;
  pointer-events: none;
}

.welcome-content {
  text-align: center;
  max-width: 600px;
  padding: 40px;
}

.welcome-logo {
  font-size: 120px;
  margin-bottom: 20px;
  animation: float 3s ease-in-out infinite;
}

.welcome-title {
  font-size: 48px;
  color: #e94560;
  text-transform: uppercase;
  letter-spacing: 4px;
  margin-bottom: 15px;
  text-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
}

.welcome-subtitle {
  font-size: 18px;
  color: #ccc;
  margin-bottom: 40px;
  line-height: 1.6;
}

.welcome-btn {
  padding: 15px 40px;
  background: linear-gradient(135deg, #e94560 0%, #c93a50 100%);
  border: 2px solid #fff;
  border-radius: 50px;
  color: #fff;
  font-size: 18px;
  font-weight: bold;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 5px 25px rgba(233, 69, 96, 0.5);
}

.welcome-btn:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 8px 30px rgba(233, 69, 96, 0.7);
}

/* MOBILE RESPONSIVE */
@media (max-width: 768px) {
  .vertical-menu {
    width: 100%;
    transform: translateX(-100%);
  }
  
  .vertical-menu.hidden {
    transform: translateX(-100%);
  }
  
  .vertical-menu:not(.hidden) {
    transform: translateX(0);
  }
  
  .menu-toggle {
    left: 10px;
  }
  
  .menu-toggle.menu-hidden {
    left: 10px;
  }
  
  .game-container {
    left: 0;
  }
  
  .detective-guide {
    left: 20px;
    bottom: 80px;
  }
  
  .detective-guide.menu-hidden {
    left: 20px;
  }
  
  .detective-avatar {
    width: 60px;
    height: 60px;
    font-size: 35px;
  }
  
  .progress-hud {
    top: 10px;
    right: 10px;
    padding: 10px 15px;
    min-width: 150px;
  }
  
  .evidence-photo {
    width: 90px;
    height: 90px;
    font-size: 45px;
  }
  
  .menu-footer {
    padding: 12px;
    gap: 8px;
  }
  
  .back-btn {
    padding: 10px;
    font-size: 12px;
  }
}
</style>
</head>
<body>

<!-- Welcome Screen -->
<div class="welcome-screen" id="welcomeScreen">
  <div class="welcome-content">
    <div class="welcome-logo">üïµÔ∏è</div>
    <div class="welcome-title">Detective Wall</div>
    <div class="welcome-subtitle">
      Unravel mysteries by finding interconnected clues.<br>
      Each piece of evidence leads to the next!
    </div>
    <button class="welcome-btn" onclick="startInvestigation()">Start Investigation</button>
  </div>
</div>

<!-- Vertical Menu -->
<div class="vertical-menu" id="verticalMenu">
  <div class="menu-header">
    <div class="menu-logo">üïµÔ∏è</div>
    <div class="menu-title">Case Files</div>
    <div class="menu-subtitle">Select Your Investigation</div>
  </div>
  
  <div class="menu-cases" id="menuCases">
    <!-- Cases will be dynamically added here -->
  </div>
  
  <div class="menu-footer">
    <button class="back-btn global-back" onclick="window.location.href='index.html'">
      üè† Back to Home
    </button>
    <button class="back-btn" onclick="returnToMenu()">
      ‚¨Ö Back to Cases
    </button>
  </div>
</div>

<!-- Menu Toggle Button -->
<div class="menu-toggle" id="menuToggle" onclick="toggleMenu()">
  ‚ò∞
</div>

<!-- Detective Guide -->
<div class="detective-guide" id="detectiveGuide">
  <div class="detective-avatar" onclick="toggleChat()">
    üïµÔ∏è
  </div>
  <div class="chat-bubble" id="chatBubble">
    <div class="chat-text" id="chatText">Click on the starting clue to begin your investigation!</div>
    <div class="chat-hint" id="chatHint">üí° Look for unlocked evidence</div>
  </div>
</div>

<!-- Game Container -->
<div class="game-container" id="gameContainer">
  <canvas class="string-canvas" id="stringCanvas"></canvas>
  <div class="investigation-wall" id="investigationWall">
    <!-- Evidence items will be dynamically added here -->
  </div>
</div>

<!-- Progress HUD -->
<div class="progress-hud" id="progressHud" style="display:none;">
  <div class="hud-title">Investigation Progress</div>
  <div class="hud-progress" id="hudProgress">
    <!-- Progress dots will be added here -->
  </div>
  <div class="hud-stats">
    <span>Found: <span class="stat-value" id="foundCount">0</span>/<span id="totalCount">0</span></span>
    <span>Time: <span class="stat-value" id="timeCount">0:00</span></span>
  </div>
</div>

<!-- Evidence Popup -->
<div class="popup-overlay" id="popupOverlay" onclick="closePopup()"></div>
<div class="evidence-popup" id="evidencePopup">
  <div class="popup-emoji" id="popupEmoji">üîç</div>
  <div class="popup-title" id="popupTitle">Evidence Found!</div>
  <div class="popup-description" id="popupDescription">Description goes here</div>
  <div class="popup-clue">
    <div class="popup-clue-title">Next Clue</div>
    <div class="popup-clue-text" id="popupClue">This leads to...</div>
  </div>
  <button class="popup-btn" onclick="closePopup()">Continue Investigation</button>
</div>

<!-- Victory Screen -->
<div class="victory-screen" id="victoryScreen">
  <div class="victory-content">
    <div class="victory-emoji">üèÜ</div>
    <div class="victory-title">Case Solved!</div>
    <div class="victory-message" id="victoryMessage">Excellent detective work!</div>
    <div class="victory-stats">
      <div class="victory-stat">‚è±Ô∏è Time: <span id="victoryTime">0:00</span></div>
      <div class="victory-stat">üîç Clues Found: <span id="victoryClues">0</span></div>
      <div class="victory-stat">‚≠ê Performance: <span id="victoryRating">Perfect</span></div>
    </div>
    <div class="victory-buttons">
      <button class="victory-btn" onclick="restartCase()">Replay Case</button>
      <button class="victory-btn secondary" onclick="selectNewCase()">New Case</button>
    </div>
  </div>
</div>

<script>
// GAME DATA
const CASES = [
  {
    id: 'diamond_heist',
    name: 'The Diamond Heist',
    number: 'CASE #001',
    difficulty: 2,
    theme: 'A priceless diamond has been stolen from the museum',
    clues: [
      { 
        emoji: 'üíé', 
        name: 'Stolen Diamond', 
        desc: 'The missing 50-carat blue diamond from the display case',
        hint: 'The thief left behind a glove at the scene',
        unlocks: [1],
        isCorrect: true
      },
      { 
        emoji: 'üß§', 
        name: 'Black Glove', 
        desc: 'A single black leather glove found near the broken glass',
        hint: 'The glove has a hotel receipt in the pocket',
        unlocks: [2],
        isCorrect: true
      },
      { 
        emoji: 'üßæ', 
        name: 'Hotel Receipt', 
        desc: 'Receipt from the Grand Plaza Hotel, Room 507',
        hint: 'A security badge was found in the hotel room',
        unlocks: [3],
        isCorrect: true
      },
      { 
        emoji: 'üé´', 
        name: 'Security Badge', 
        desc: 'Forged museum security badge with scratched ID number',
        hint: 'The badge maker left their business card',
        unlocks: [4],
        isCorrect: true
      },
      { 
        emoji: 'üí≥', 
        name: 'Business Card', 
        desc: 'Card for "Quick ID Services" - a fake ID operation',
        hint: 'A burner phone was found at the ID shop',
        unlocks: [5],
        isCorrect: true
      },
      { 
        emoji: 'üì±', 
        name: 'Burner Phone', 
        desc: 'Prepaid phone with only one contact: "The Fence"',
        hint: 'Text messages reveal a meeting at the old warehouse',
        unlocks: [6],
        isCorrect: true
      },
      { 
        emoji: 'üìç', 
        name: 'Location Pin', 
        desc: 'GPS coordinates to an abandoned warehouse by the docks',
        hint: 'Inside the warehouse, you find the suspect',
        unlocks: [7],
        isCorrect: true
      },
      { 
        emoji: 'üë§', 
        name: 'The Suspect', 
        desc: 'Marcus "The Shadow" Rivera - caught red-handed with the diamond!',
        hint: 'Case closed! The diamond has been recovered.',
        unlocks: [],
        isCorrect: true
      }
    ],
    decoys: [
      { emoji: 'üö¨', name: 'Cigarette Butt', desc: 'Old cigarette from unrelated visitor - dead end!' },
      { emoji: 'üé≠', name: 'Theater Mask', desc: 'Props from nearby theater - not relevant to the heist' },
      { emoji: '‚òï', name: 'Coffee Cup', desc: 'Leftover from museum staff - just trash' },
      { emoji: 'üî®', name: 'Hammer', desc: 'Construction tool from renovation work - red herring!' },
      { emoji: 'üé®', name: 'Paint Chip', desc: 'From wall repair last month - wrong lead' }
    ]
  },
  {
    id: 'art_forgery',
    name: 'The Art Forgery',
    number: 'CASE #002',
    difficulty: 3,
    theme: 'A famous painting has been replaced with a perfect forgery',
    clues: [
      { 
        emoji: 'üñºÔ∏è', 
        name: 'Forged Painting', 
        desc: 'The fake Van Gogh that replaced the original in the gallery',
        hint: 'Microscopic analysis reveals unique paint particles',
        unlocks: [1],
        isCorrect: true
      },
      { 
        emoji: 'üî¨', 
        name: 'Paint Sample', 
        desc: 'Rare pigment only available from one supplier',
        hint: 'The supplier keeps records of all purchases',
        unlocks: [2],
        isCorrect: true
      },
      { 
        emoji: 'üìã', 
        name: 'Purchase Order', 
        desc: 'Order for rare pigments delivered to an art studio',
        hint: 'The studio belongs to a struggling artist',
        unlocks: [3],
        isCorrect: true
      },
      { 
        emoji: 'üé®', 
        name: 'Art Studio', 
        desc: 'Hidden studio filled with forgery equipment',
        hint: 'A shipping label for a crate to overseas buyer',
        unlocks: [4],
        isCorrect: true
      },
      { 
        emoji: 'üì¶', 
        name: 'Shipping Label', 
        desc: 'International shipment to a private collector',
        hint: 'The collector is actually an underworld art dealer',
        unlocks: [5],
        isCorrect: true
      },
      { 
        emoji: 'üí∞', 
        name: 'Money Trail', 
        desc: 'Wire transfer records showing massive payment',
        hint: 'Security footage from the gallery on theft night',
        unlocks: [6],
        isCorrect: true
      },
      { 
        emoji: 'üìπ', 
        name: 'CCTV Footage', 
        desc: 'Video shows the forger switching the paintings',
        hint: 'The original painting is hidden in a secret location',
        unlocks: [7],
        isCorrect: true
      },
      { 
        emoji: 'üèõÔ∏è', 
        name: 'Hidden Vault', 
        desc: 'Original Van Gogh found in a storage facility!',
        hint: 'Both the painting and the forger have been recovered!',
        unlocks: [],
        isCorrect: true
      }
    ],
    decoys: [
      { emoji: 'üñåÔ∏è', name: 'Paint Brush', desc: 'Just a regular brush from cleaning supplies - wrong!' },
      { emoji: 'üì∏', name: 'Tourist Photo', desc: 'Random visitor selfie - not related to the crime' },
      { emoji: 'üéüÔ∏è', name: 'Ticket Stub', desc: 'Old gallery entrance ticket - not helpful' },
      { emoji: 'üßπ', name: 'Cleaning Rag', desc: 'Janitor\'s equipment - just a distraction' },
      { emoji: 'üóùÔ∏è', name: 'Old Key', desc: 'Lost key from months ago - dead end!' }
    ]
  },
  {
    id: 'missing_scientist',
    name: 'The Missing Scientist',
    number: 'CASE #003',
    difficulty: 2,
    theme: 'A renowned scientist has vanished with secret research',
    clues: [
      { 
        emoji: 'üî¨', 
        name: 'Empty Lab', 
        desc: 'Dr. Chen\'s laboratory, abandoned in the middle of an experiment',
        hint: 'A torn page from her research notebook on the floor',
        unlocks: [1],
        isCorrect: true
      },
      { 
        emoji: 'üìì', 
        name: 'Research Notes', 
        desc: 'Partial notes about a breakthrough discovery',
        hint: 'Mentions a secret meeting with an unknown person',
        unlocks: [2],
        isCorrect: true
      },
      { 
        emoji: '‚úâÔ∏è', 
        name: 'Encrypted Email', 
        desc: 'Strange coded message sent the night she disappeared',
        hint: 'The code references a specific cafe downtown',
        unlocks: [3],
        isCorrect: true
      },
      { 
        emoji: '‚òï', 
        name: 'Coffee Shop', 
        desc: 'The Midnight Brew - where the meeting took place',
        hint: 'Barista remembers Dr. Chen meeting a corporate executive',
        unlocks: [4],
        isCorrect: true
      },
      { 
        emoji: 'üíº', 
        name: 'Corporate Badge', 
        desc: 'ID badge from rival pharmaceutical company found in booth',
        hint: 'The company has been trying to steal her research',
        unlocks: [5],
        isCorrect: true
      },
      { 
        emoji: 'üè¢', 
        name: 'Company HQ', 
        desc: 'Rival company building with suspicious activity',
        hint: 'Dr. Chen\'s phone GPS signal last pinged here',
        unlocks: [6],
        isCorrect: true
      },
      { 
        emoji: 'üì°', 
        name: 'GPS Signal', 
        desc: 'Signal leads to basement level, unauthorized area',
        hint: 'You hear Dr. Chen calling for help!',
        unlocks: [7],
        isCorrect: true
      },
      { 
        emoji: 'üö™', 
        name: 'Secret Lab', 
        desc: 'Dr. Chen found! She was being held captive for her research',
        hint: 'Case solved! The rival company has been exposed!',
        unlocks: [],
        isCorrect: true
      }
    ],
    decoys: [
      { emoji: 'üß™', name: 'Test Tube', desc: 'Empty vial from old experiment - not important' },
      { emoji: 'üìö', name: 'Library Book', desc: 'Overdue textbook - unrelated to disappearance' },
      { emoji: 'ü•º', name: 'Lab Coat', desc: 'Spare coat in closet - just clothing' },
      { emoji: 'üîã', name: 'Dead Battery', desc: 'Old equipment battery - red herring!' },
      { emoji: 'üìÑ', name: 'Grocery List', desc: 'Personal shopping list - not a clue' }
    ]
  },
  {
    id: 'cyber_crime',
    name: 'The Cyber Heist',
    number: 'CASE #004',
    difficulty: 3,
    theme: 'Hackers have stolen millions from the city bank',
    clues: [
      { 
        emoji: 'üíª', 
        name: 'Hacked System', 
        desc: 'Bank\'s security system compromised, money transferred out',
        hint: 'Malware signature found in the system logs',
        unlocks: [1],
        isCorrect: true
      },
      { 
        emoji: 'üêõ', 
        name: 'Malware Code', 
        desc: 'Sophisticated virus with unique coding patterns',
        hint: 'Code matches previous attacks by "Ghost Protocol" group',
        unlocks: [2],
        isCorrect: true
      },
      { 
        emoji: 'üëª', 
        name: 'Hacker Group', 
        desc: 'Known cyber criminal organization with many aliases',
        hint: 'Dark web forum shows recent chatter about the heist',
        unlocks: [3],
        isCorrect: true
      },
      { 
        emoji: 'üåê', 
        name: 'Dark Web Post', 
        desc: 'Anonymous post bragging about the successful bank job',
        hint: 'IP address briefly exposed before using VPN',
        unlocks: [4],
        isCorrect: true
      },
      { 
        emoji: 'üîç', 
        name: 'IP Trace', 
        desc: 'Brief connection from a local internet cafe',
        hint: 'Cafe security camera caught the hacker',
        unlocks: [5],
        isCorrect: true
      },
      { 
        emoji: 'üìπ', 
        name: 'Surveillance', 
        desc: 'Video of suspect using laptop at specific time',
        hint: 'Facial recognition identifies the hacker',
        unlocks: [6],
        isCorrect: true
      },
      { 
        emoji: 'üé≠', 
        name: 'Identity Revealed', 
        desc: 'Alex "Cipher" Morgan - former IT security expert',
        hint: 'Cryptocurrency wallet traced to luxury apartment',
        unlocks: [7],
        isCorrect: true
      },
      { 
        emoji: 'üè†', 
        name: 'Hideout Found', 
        desc: 'Arrested with stolen funds and hacking equipment!',
        hint: 'All stolen money recovered! Case closed!',
        unlocks: [],
        isCorrect: true
      }
    ],
    decoys: [
      { emoji: 'üñ±Ô∏è', name: 'Wireless Mouse', desc: 'Random office equipment - not evidence' },
      { emoji: 'üíæ', name: 'Floppy Disk', desc: 'Ancient storage device - totally irrelevant!' },
      { emoji: 'üìû', name: 'Phone Book', desc: 'Old directory from 2010 - useless' },
      { emoji: 'üñ®Ô∏è', name: 'Printer Error', desc: 'Paper jam from weeks ago - red herring!' },
      { emoji: 'üîå', name: 'Power Cable', desc: 'Generic computer cable - not a clue' }
    ]
  }
];

// GAME STATE
let currentCase = null;
let foundClues = new Set();
let startTime = null;
let timerInterval = null;
let menuHidden = false;
let chatTimeout = null;

// INITIALIZE
function init() {
  renderCaseMenu();
  setupCanvas();
  window.addEventListener('resize', drawConnections);
}

function startInvestigation() {
  document.getElementById('welcomeScreen').classList.add('hidden');
  
  // Make sure menu is visible when entering from welcome screen
  if (menuHidden) {
    menuHidden = false;
    const menu = document.getElementById('verticalMenu');
    const toggle = document.getElementById('menuToggle');
    const container = document.getElementById('gameContainer');
    const guide = document.getElementById('detectiveGuide');
    
    menu.classList.remove('hidden');
    toggle.classList.remove('menu-hidden');
    container.classList.remove('menu-hidden');
    guide.classList.remove('menu-hidden');
  }
}

function renderCaseMenu() {
  const container = document.getElementById('menuCases');
  container.innerHTML = '';
  
  CASES.forEach(caseData => {
    const card = document.createElement('div');
    card.className = 'case-card';
    card.dataset.caseId = caseData.id;
    
    const stars = '‚≠ê'.repeat(caseData.difficulty);
    
    card.innerHTML = `
      <div class="case-number">${caseData.number}</div>
      <div class="case-name">${caseData.name}</div>
      <div class="case-difficulty">
        <span class="difficulty-stars">${stars}</span>
        <span>Difficulty</span>
      </div>
    `;
    
    card.addEventListener('click', function() {
      selectCase(caseData.id, this);
    });
    
    container.appendChild(card);
  });
}

function selectCase(caseId, clickedCard) {
  currentCase = CASES.find(c => c.id === caseId);
  if (!currentCase) return;
  
  foundClues.clear();
  startTime = Date.now();
  
  // Update UI - mark active card
  document.querySelectorAll('.case-card').forEach(card => card.classList.remove('active'));
  if (clickedCard) {
    clickedCard.classList.add('active');
  }
  
  // Show game container and HUD
  document.getElementById('gameContainer').classList.add('active');
  document.getElementById('progressHud').style.display = 'block';
  
  setupCase();
  startTimer();
  showChat(`Starting investigation: ${currentCase.name}`, `Find the ${currentCase.clues[0].emoji} ${currentCase.clues[0].name} to begin!`);
}

function setupCase() {
  const wall = document.getElementById('investigationWall');
  wall.innerHTML = '';
  
  const totalClues = currentCase.clues.length;
  const hudProgress = document.getElementById('hudProgress');
  hudProgress.innerHTML = '';
  
  // Create progress dots (only for correct clues)
  for (let i = 0; i < totalClues; i++) {
    const dot = document.createElement('div');
    dot.className = 'progress-dot';
    dot.id = `progress-${i}`;
    hudProgress.appendChild(dot);
  }
  
  document.getElementById('foundCount').textContent = '0';
  document.getElementById('totalCount').textContent = totalClues;
  
  // Position clues in a web-like pattern
  const centerX = window.innerWidth / 2;
  const centerY = window.innerHeight / 2;
  const radius = Math.min(window.innerWidth, window.innerHeight) * 0.35;
  
  // Add correct clues
  currentCase.clues.forEach((clue, index) => {
    const angle = (index / totalClues) * Math.PI * 2 - Math.PI / 2;
    const x = centerX + Math.cos(angle) * radius - 140;
    const y = centerY + Math.sin(angle) * radius;
    
    const item = document.createElement('div');
    item.className = 'evidence-item';
    item.id = `clue-${index}`;
    item.dataset.type = 'correct';
    item.dataset.index = index;
    
    // First clue is unlocked
    if (index !== 0) {
      item.classList.add('locked');
    }
    
    item.style.left = `${x}px`;
    item.style.top = `${y}px`;
    
    item.innerHTML = `
      <div class="evidence-photo">
        ${clue.emoji}
        ${index !== 0 ? '<div class="lock-icon">üîí</div>' : ''}
      </div>
      <div class="evidence-label">${clue.name}</div>
    `;
    
    item.onclick = () => clickClue(index);
    wall.appendChild(item);
  });
  
  // Add decoy clues (wrong evidence)
  if (currentCase.decoys && currentCase.decoys.length > 0) {
    currentCase.decoys.forEach((decoy, decoyIndex) => {
      // Random position not too close to correct clues
      let x, y, tooClose, attempts = 0;
      do {
        tooClose = false;
        const angle = Math.random() * Math.PI * 2;
        const dist = radius * 0.5 + Math.random() * radius * 0.6;
        x = centerX + Math.cos(angle) * dist - 140;
        y = centerY + Math.sin(angle) * dist;
        
        // Check distance from all correct clues
        for (let i = 0; i < totalClues; i++) {
          const clueEl = document.getElementById(`clue-${i}`);
          if (clueEl) {
            const clueX = parseInt(clueEl.style.left);
            const clueY = parseInt(clueEl.style.top);
            const distance = Math.sqrt(Math.pow(x - clueX, 2) + Math.pow(y - clueY, 2));
            if (distance < 150) {
              tooClose = true;
              break;
            }
          }
        }
        attempts++;
      } while (tooClose && attempts < 50);
      
      const item = document.createElement('div');
      item.className = 'evidence-item';
      item.id = `decoy-${decoyIndex}`;
      item.dataset.type = 'decoy';
      item.dataset.index = decoyIndex;
      
      item.style.left = `${x}px`;
      item.style.top = `${y}px`;
      
      item.innerHTML = `
        <div class="evidence-photo">
          ${decoy.emoji}
        </div>
        <div class="evidence-label">${decoy.name}</div>
      `;
      
      item.onclick = () => clickDecoy(decoyIndex, decoy);
      wall.appendChild(item);
    });
  }
  
  drawConnections();
}

function clickDecoy(decoyIndex, decoy) {
  const decoyElement = document.getElementById(`decoy-${decoyIndex}`);
  
  // Mark as wrong
  decoyElement.classList.add('wrong');
  
  // Show X mark
  const xMark = document.createElement('div');
  xMark.className = 'wrong-x';
  xMark.textContent = '‚úó';
  decoyElement.appendChild(xMark);
  
  // Remove X after animation
  setTimeout(() => {
    xMark.remove();
  }, 1500);
  
  // Show wrong clue popup
  document.getElementById('popupEmoji').textContent = decoy.emoji;
  document.getElementById('popupTitle').textContent = 'Wrong Clue!';
  document.getElementById('popupDescription').textContent = decoy.desc;
  document.getElementById('popupClue').textContent = 'This doesn\'t help the investigation. Look for evidence that connects!';
  
  const popup = document.getElementById('evidencePopup');
  popup.classList.add('wrong');
  
  document.getElementById('popupOverlay').classList.add('show');
  popup.classList.add('show');
  
  // Play wrong sound
  playSound([400, 350, 300]);
  
  // Update chat
  showChat('Dead end!', 'That\'s not the right evidence. Follow the investigation chain.');
  
  // Remove wrong styling from popup when closed
  setTimeout(() => {
    decoyElement.classList.remove('wrong');
  }, 2000);
}

function clickClue(index) {
  const clueElement = document.getElementById(`clue-${index}`);
  
  if (clueElement.classList.contains('locked')) {
    showChat('This clue is locked!', 'Follow the investigation path to unlock it.');
    return;
  }
  
  if (foundClues.has(index)) {
    showChat('Already investigated!', 'Move on to the next clue.');
    return;
  }
  
  foundClues.add(index);
  clueElement.classList.add('found');
  
  const clue = currentCase.clues[index];
  
  // Update progress
  document.getElementById(`progress-${index}`).classList.add('found');
  document.getElementById('foundCount').textContent = foundClues.size;
  
  // Unlock connected clues
  clue.unlocks.forEach(nextIndex => {
    const nextClue = document.getElementById(`clue-${nextIndex}`);
    if (nextClue) {
      nextClue.classList.remove('locked');
      const lock = nextClue.querySelector('.lock-icon');
      if (lock) lock.remove();
    }
  });
  
  // Show popup
  showEvidencePopup(clue, index);
  
  // Spawn particles
  spawnParticles(clueElement);
  
  // Draw updated connections
  drawConnections();
  
  // Check for case completion
  if (foundClues.size === currentCase.clues.length) {
    setTimeout(completeCaseInvestigation, 1000);
  }
}

function showEvidencePopup(clue, index) {
  document.getElementById('popupEmoji').textContent = clue.emoji;
  document.getElementById('popupTitle').textContent = clue.name;
  document.getElementById('popupDescription').textContent = clue.desc;
  document.getElementById('popupClue').textContent = clue.hint;
  
  document.getElementById('popupOverlay').classList.add('show');
  document.getElementById('evidencePopup').classList.add('show');
  
  // Play sound
  playSound([523.25, 659.25, 783.99]);
}

function closePopup() {
  document.getElementById('popupOverlay').classList.remove('show');
  const popup = document.getElementById('evidencePopup');
  popup.classList.remove('show');
  popup.classList.remove('wrong');
}

function drawConnections() {
  const canvas = document.getElementById('stringCanvas');
  const ctx = canvas.getContext('2d');
  
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  if (!currentCase) return;
  
  // Only draw connections for correct clues
  currentCase.clues.forEach((clue, index) => {
    const element = document.getElementById(`clue-${index}`);
    if (!element) return;
    
    const rect = element.getBoundingClientRect();
    const startX = rect.left + rect.width / 2;
    const startY = rect.top + rect.height / 2;
    
    clue.unlocks.forEach(nextIndex => {
      const nextElement = document.getElementById(`clue-${nextIndex}`);
      if (!nextElement) return;
      
      const nextRect = nextElement.getBoundingClientRect();
      const endX = nextRect.left + nextRect.width / 2;
      const endY = nextRect.top + nextRect.height / 2;
      
      // Draw string
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      
      const isFound = foundClues.has(index);
      const isNextUnlocked = !nextElement.classList.contains('locked');
      
      if (isFound || isNextUnlocked) {
        ctx.strokeStyle = '#ffd700';
        ctx.lineWidth = 3;
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#ffd700';
      } else {
        ctx.strokeStyle = '#533a71';
        ctx.lineWidth = 2;
        ctx.shadowBlur = 0;
      }
      
      // Curved line
      const midX = (startX + endX) / 2;
      const midY = (startY + endY) / 2 - 50;
      ctx.quadraticCurveTo(midX, midY, endX, endY);
      ctx.stroke();
      
      // Reset shadow
      ctx.shadowBlur = 0;
    });
  });
}

function spawnParticles(element) {
  const rect = element.getBoundingClientRect();
  const centerX = rect.left + rect.width / 2;
  const centerY = rect.top + rect.height / 2;
  
  const particles = ['‚ú®', '‚≠ê', 'üí´', 'üåü'];
  
  for (let i = 0; i < 15; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
    particle.style.left = centerX + 'px';
    particle.style.top = centerY + 'px';
    particle.style.fontSize = (Math.random() * 20 + 15) + 'px';
    
    const angle = Math.random() * Math.PI * 2;
    const distance = Math.random() * 100 + 50;
    particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
    particle.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
    
    document.body.appendChild(particle);
    
    setTimeout(() => particle.remove(), 3000);
  }
}

function completeCaseInvestigation() {
  clearInterval(timerInterval);
  
  const elapsed = Math.floor((Date.now() - startTime) / 1000);
  const minutes = Math.floor(elapsed / 60);
  const seconds = elapsed % 60;
  const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
  
  let rating = 'Perfect Detective!';
  if (elapsed > 180) rating = 'Excellent Work!';
  if (elapsed > 300) rating = 'Good Job!';
  
  document.getElementById('victoryTime').textContent = timeStr;
  document.getElementById('victoryClues').textContent = foundClues.size;
  document.getElementById('victoryRating').textContent = rating;
  document.getElementById('victoryMessage').textContent = `${currentCase.theme} - Case closed!`;
  
  document.getElementById('victoryScreen').classList.add('show');
  
  playSound([523.25, 659.25, 783.99, 1046.50]);
  
  // Victory particles
  for (let i = 0; i < 50; i++) {
    setTimeout(() => {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.textContent = ['üéâ', 'üéä', '‚≠ê', 'üèÜ'][Math.floor(Math.random() * 4)];
      particle.style.left = Math.random() * window.innerWidth + 'px';
      particle.style.top = '-50px';
      particle.style.fontSize = (Math.random() * 30 + 20) + 'px';
      document.body.appendChild(particle);
      setTimeout(() => particle.remove(), 3000);
    }, i * 50);
  }
}

function restartCase() {
  document.getElementById('victoryScreen').classList.remove('show');
  if (currentCase) {
    // Find the active case card and restart
    const caseCard = document.querySelector(`.case-card[data-case-id="${currentCase.id}"]`);
    selectCase(currentCase.id, caseCard);
  }
}

function selectNewCase() {
  document.getElementById('victoryScreen').classList.remove('show');
  returnToMenu();
}

function startTimer() {
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const minutes = Math.floor(elapsed / 60);
    const seconds = elapsed % 60;
    document.getElementById('timeCount').textContent = 
      `${minutes}:${seconds.toString().padStart(2, '0')}`;
  }, 1000);
}

function toggleMenu() {
  menuHidden = !menuHidden;
  const menu = document.getElementById('verticalMenu');
  const toggle = document.getElementById('menuToggle');
  const container = document.getElementById('gameContainer');
  const guide = document.getElementById('detectiveGuide');
  
  if (menuHidden) {
    menu.classList.add('hidden');
    toggle.classList.add('menu-hidden');
    container.classList.add('menu-hidden');
    guide.classList.add('menu-hidden');
  } else {
    menu.classList.remove('hidden');
    toggle.classList.remove('menu-hidden');
    container.classList.remove('menu-hidden');
    guide.classList.remove('menu-hidden');
  }
  
  setTimeout(drawConnections, 400);
}

function returnToMenu() {
  clearInterval(timerInterval);
  
  // Hide game elements
  document.getElementById('gameContainer').classList.remove('active');
  document.getElementById('progressHud').style.display = 'none';
  
  // Clear active states
  document.querySelectorAll('.case-card').forEach(card => card.classList.remove('active'));
  
  // Clear canvas
  const canvas = document.getElementById('stringCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Reset state
  currentCase = null;
  hideChat();
  
  // Make sure menu is visible
  if (menuHidden) {
    toggleMenu();
  }
}

function showChat(text, hint = '') {
  clearTimeout(chatTimeout);
  
  const bubble = document.getElementById('chatBubble');
  document.getElementById('chatText').textContent = text;
  document.getElementById('chatHint').textContent = hint ? `üí° ${hint}` : '';
  
  bubble.classList.add('show');
  
  chatTimeout = setTimeout(() => {
    bubble.classList.remove('show');
  }, 5000);
}

function hideChat() {
  document.getElementById('chatBubble').classList.remove('show');
}

function toggleChat() {
  const bubble = document.getElementById('chatBubble');
  bubble.classList.toggle('show');
}

function setupCanvas() {
  const canvas = document.getElementById('stringCanvas');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

function playSound(frequencies) {
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    frequencies.forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.frequency.value = freq;
      osc.type = 'sine';
      const t = ctx.currentTime + i * 0.1;
      gain.gain.setValueAtTime(0.15, t);
      gain.gain.exponentialRampToValueAtTime(0.001, t + 0.4);
      osc.start(t);
      osc.stop(t + 0.4);
    });
  } catch (e) {}
}

// Initialize on load
window.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>