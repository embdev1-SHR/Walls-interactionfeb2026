<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Fruit Ninja</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;user-select:none;-webkit-user-select:none}
body{overflow:hidden;font-family:Arial,sans-serif;background:#1a1a2e;touch-action:none}
#gameCanvas{display:block;cursor:none}
.ui-top{position:absolute;top:0;left:0;width:100%;pointer-events:none;z-index:10}
.stats{display:flex;justify-content:space-between;padding:16px 30px}
.stat-item{background:rgba(0,0,0,.5);padding:12px 24px;border-radius:14px;backdrop-filter:blur(8px);border:2px solid rgba(255,255,255,.15)}
.stat-label{font-size:13px;font-weight:700;color:rgba(255,255,255,.6);text-transform:uppercase;letter-spacing:1.5px}
.stat-value{font-size:32px;font-weight:700;color:#ffd700}
.lives{display:flex;gap:6px;align-items:center}
.heart{font-size:30px;filter:drop-shadow(1px 1px 3px rgba(0,0,0,.5));transition:all .3s}
.combo-display{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  font-size:72px;font-weight:900;color:#ff6b6b;
  text-shadow:3px 3px 6px rgba(0,0,0,.7);
  pointer-events:none;z-index:20;
  animation:comboAnim 1s ease-out forwards;
}
@keyframes comboAnim{
  0%{opacity:0;transform:translate(-50%,-50%) scale(.5)}
  40%{opacity:1;transform:translate(-50%,-50%) scale(1.4)}
  100%{opacity:0;transform:translate(-50%,-50%) scale(1) translateY(-80px)}
}
.game-over{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  background:rgba(0,0,0,.92);padding:50px 70px;border-radius:24px;
  text-align:center;border:4px solid #ffd700;
  box-shadow:0 0 40px rgba(255,215,0,.4);
  display:none;z-index:100;pointer-events:auto;
}
.game-over.show{display:block}
.game-over h1{font-size:52px;color:#ff6b6b;margin-bottom:16px}
.game-over .final-score{font-size:40px;color:#ffd700;margin:16px 0}
.go-btn{
  margin-top:20px;padding:16px 48px;font-size:22px;font-weight:700;
  background:linear-gradient(135deg,#2ecc71,#27ae60);color:white;
  border:none;border-radius:50px;cursor:pointer;transition:all .3s;
  pointer-events:auto;touch-action:manipulation;-webkit-tap-highlight-color:transparent;
}
.go-btn:active{transform:scale(.95)}
.go-btn+.go-btn{margin-left:12px;background:linear-gradient(135deg,#3498db,#2980b9)}
.start-message{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  font-size:32px;color:white;text-align:center;
  background:rgba(0,0,0,.7);padding:36px 50px;border-radius:20px;
  backdrop-filter:blur(10px);pointer-events:auto;z-index:30;
  animation:pulse 2s ease-in-out infinite;cursor:pointer;
  touch-action:manipulation;-webkit-tap-highlight-color:transparent;
  border:3px solid rgba(255,255,255,.2);
}
@keyframes pulse{0%,100%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.03)}}
.bottom-bar{
  position:absolute;bottom:16px;left:50%;transform:translateX(-50%);
  z-index:50;pointer-events:auto;
}
.btn-back{
  padding:12px 28px;font-size:16px;font-weight:600;
  background:rgba(0,0,0,.5);color:white;
  border:2px solid rgba(255,255,255,.3);border-radius:50px;
  cursor:pointer;backdrop-filter:blur(8px);transition:all .3s;
  touch-action:manipulation;-webkit-tap-highlight-color:transparent;
}
.btn-back:active{transform:scale(.93)}
.bomb-flash{
  position:fixed;inset:0;background:rgba(255,60,0,.35);
  pointer-events:none;z-index:15;animation:flashOut .4s ease-out forwards;
}
@keyframes flashOut{0%{opacity:1}100%{opacity:0}}
@keyframes screenShake{
  0%,100%{transform:translate(0,0)}
  10%{transform:translate(-8px,6px)}
  20%{transform:translate(6px,-8px)}
  30%{transform:translate(-6px,4px)}
  40%{transform:translate(4px,-6px)}
  50%{transform:translate(-4px,8px)}
  60%{transform:translate(8px,-4px)}
  70%{transform:translate(-6px,6px)}
  80%{transform:translate(4px,-4px)}
  90%{transform:translate(-2px,2px)}
}
.shaking{animation:screenShake .5s ease-out}
</style>
</head>
<body>
<audio id="fruit-ninja-music" preload="auto" loop>
  <source src="../assets/Audio/idoberg-space-chords-loop-310493.mp3" type="audio/mpeg">
</audio>
<canvas id="gameCanvas"></canvas>

<div class="ui-top">
  <div class="stats">
    <div class="stat-item">
      <div class="stat-label">Score</div>
      <div class="stat-value" id="scoreDisplay">0</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Time</div>
      <div class="stat-value" id="timerDisplay">60</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Lives</div>
      <div class="lives" id="livesDisplay">
        <span class="heart">&#10084;&#65039;</span>
        <span class="heart">&#10084;&#65039;</span>
        <span class="heart">&#10084;&#65039;</span>
      </div>
    </div>
  </div>
</div>

<div class="start-message" id="startMessage">
  &#127817; Slice the Fruits! &#127818;<br>
  <span style="font-size:20px;margin-top:8px;display:block">Avoid the Bombs &#128163;</span>
  <span style="font-size:16px;margin-top:12px;display:block;color:rgba(255,255,255,.5)">Tap to Start</span>
</div>

<div class="game-over" id="gameOver">
  <h1>GAME OVER!</h1>
  <div class="final-score">Score: <span id="finalScore">0</span></div>
  <div>
    <button class="go-btn" id="playAgainBtn">Play Again</button>
    <button class="go-btn" id="goMenuBtn">Menu</button>
  </div>
</div>

<div class="bottom-bar">
  <button class="btn-back" id="backBtn">Back to Menu</button>
</div>

<script>
var canvas = document.getElementById('gameCanvas');
var ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

var score = 0, lives = 3, timeLeft = 60;
var gameRunning = false, gameStarted = false;
var combo = 0, comboTimer = 0;
var fruits = [], particles = [], sliceTrails = {};
var spawnTimer = null, clockTimer = null;

var fruitTypes = [
  {name:'apple',color:'#ff4444',emoji:'\uD83C\uDF4E',points:10},
  {name:'orange',color:'#ff8844',emoji:'\uD83C\uDF4A',points:10},
  {name:'watermelon',color:'#44ff44',emoji:'\uD83C\uDF49',points:15},
  {name:'banana',color:'#ffff44',emoji:'\uD83C\uDF4C',points:10},
  {name:'grape',color:'#8844ff',emoji:'\uD83C\uDF47',points:12},
  {name:'strawberry',color:'#ff4488',emoji:'\uD83C\uDF53',points:10},
  {name:'pineapple',color:'#ffaa44',emoji:'\uD83C\uDF4D',points:15},
  {name:'kiwi',color:'#88ff44',emoji:'\uD83E\uDD5D',points:12}
];
var bombType = {name:'bomb',color:'#333',emoji:'\uD83D\uDCA3',points:-50};

function Fruit(x,y,type){
  this.x=x;this.y=y;this.type=type;
  this.size=type.name==='bomb'?150:180;
  this.vx=(Math.random()-.5)*6;
  // Fixed upward velocity that will reach the top of screen
  this.vy = -15; // Simple fixed value that works for most screen heights
  this.rotation=Math.random()*Math.PI*2;
  this.rotationSpeed=(Math.random()-.5)*.2;
  this.gravity=0.4; // Slightly lower gravity for longer arc
  this.sliced=false;this.alpha=1;
}
Fruit.prototype.update=function(){
  this.vy+=this.gravity;this.x+=this.vx;this.y+=this.vy;
  this.rotation+=this.rotationSpeed;
  if(this.sliced)this.alpha-=0.05;
};
Fruit.prototype.draw=function(){
  ctx.save();ctx.globalAlpha=this.alpha;
  ctx.translate(this.x,this.y);ctx.rotate(this.rotation);
  ctx.font=this.size+'px Arial';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText(this.type.emoji,0,0);ctx.restore();
};
Fruit.prototype.isOffScreen=function(){return this.y>canvas.height+100||this.alpha<=0};
Fruit.prototype.contains=function(x,y){return Math.hypot(x-this.x,y-this.y)<this.size*.6};
Fruit.prototype.slice=function(){
  if(this.sliced)return;
  this.sliced=true;
  if(this.type.name==='bomb'){
    lives--;updateLives();
    createBombExplosion(this.x,this.y);
    triggerScreenShake();
    if(lives<=0)endGame();
  }else{
    score+=this.type.points;combo++;comboTimer=60;
    updateScore();createParticles(this.x,this.y,this.type.color);
    if(combo>=3){showCombo(combo);score+=combo*5;updateScore();}
  }
};

function Particle(x,y,color,size,vx,vy){
  this.x=x;this.y=y;this.color=color;
  this.size=size||Math.random()*8+4;
  this.vx=vx||(Math.random()-.5)*10;
  this.vy=vy||(Math.random()-.5)*10;
  this.alpha=1;this.gravity=0.3;
}
Particle.prototype.update=function(){
  this.vx*=.98;this.vy+=this.gravity;this.x+=this.vx;this.y+=this.vy;this.alpha-=.02;
};
Particle.prototype.draw=function(){
  ctx.save();ctx.globalAlpha=this.alpha;ctx.fillStyle=this.color;
  ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();ctx.restore();
};
Particle.prototype.isDead=function(){return this.alpha<=0};

function createParticles(x,y,color){
  for(var i=0;i<20;i++)particles.push(new Particle(x,y,color));
}

function createBombExplosion(x,y){
  var colors=['#ff4400','#ff6600','#ff8800','#ffaa00','#ff2200','#333'];
  for(var i=0;i<60;i++){
    var angle=Math.random()*Math.PI*2;
    var speed=3+Math.random()*12;
    var c=colors[Math.floor(Math.random()*colors.length)];
    particles.push(new Particle(x,y,c,Math.random()*12+4,Math.cos(angle)*speed,Math.sin(angle)*speed-5));
  }
  for(var i=0;i<8;i++){
    var a2=Math.random()*Math.PI*2;
    var sp2=8+Math.random()*6;
    particles.push(new Particle(x,y,'#fff',Math.random()*6+2,Math.cos(a2)*sp2,Math.sin(a2)*sp2-3));
  }
  var flash=document.createElement('div');
  flash.className='bomb-flash';
  document.body.appendChild(flash);
  flash.addEventListener('animationend',function(){flash.remove()});
  try{
    var ac=new(window.AudioContext||window.webkitAudioContext)();
    var now=ac.currentTime;
    var buf=ac.createBuffer(1,ac.sampleRate*.3,ac.sampleRate);
    var data=buf.getChannelData(0);
    for(var s=0;s<data.length;s++)data[s]=(Math.random()*2-1)*Math.exp(-s/(ac.sampleRate*.04));
    var src=ac.createBufferSource(),g=ac.createGain();
    src.buffer=buf;src.connect(g);g.connect(ac.destination);
    g.gain.setValueAtTime(.4,now);g.gain.exponentialRampToValueAtTime(.001,now+.3);
    src.start(now);
  }catch(e){}
}

function triggerScreenShake(){
  canvas.classList.remove('shaking');
  void canvas.offsetWidth;
  canvas.classList.add('shaking');
  setTimeout(function(){canvas.classList.remove('shaking')},500);
}

function spawnFruit(){
  if(!gameRunning)return;
  var x=Math.random()*(canvas.width-200)+100;
  var y=canvas.height+50;
  var isBomb=Math.random()<.15;
  var type=isBomb?bombType:fruitTypes[Math.floor(Math.random()*fruitTypes.length)];
  fruits.push(new Fruit(x,y,type));
}

function updateScore(){document.getElementById('scoreDisplay').textContent=score}
function updateTimer(){document.getElementById('timerDisplay').textContent=timeLeft}
function updateLives(){
  var el=document.getElementById('livesDisplay');el.innerHTML='';
  for(var i=0;i<lives;i++){
    var h=document.createElement('span');h.className='heart';h.textContent='\u2764\uFE0F';el.appendChild(h);
  }
}

function showCombo(c){
  var d=document.createElement('div');d.className='combo-display';
  d.textContent=c+'x COMBO!';d.style.left=(Math.random()*40+30)+'%';
  document.body.appendChild(d);setTimeout(function(){d.remove()},1000);
}

function endGame(){
  gameRunning=false;
  if(spawnTimer)clearInterval(spawnTimer);
  if(clockTimer)clearInterval(clockTimer);
  document.getElementById('finalScore').textContent=score;
  document.getElementById('gameOver').classList.add('show');
}

function startGame(){
  gameRunning=true;gameStarted=true;
  document.getElementById('startMessage').style.display='none';
  spawnTimer=setInterval(function(){if(gameRunning)spawnFruit();else clearInterval(spawnTimer)},750);
  clockTimer=setInterval(function(){
    if(!gameRunning){clearInterval(clockTimer);return}
    timeLeft--;updateTimer();
    if(timeLeft<=0){clearInterval(clockTimer);endGame();}
  },1000);
}

function restartGame(){
  score=0;lives=3;timeLeft=60;combo=0;
  fruits.length=0;particles.length=0;sliceTrails={};
  updateScore();updateTimer();updateLives();
  document.getElementById('gameOver').classList.remove('show');
  startGame();
}

function checkSlice(x,y,lastX,lastY){
  if(!gameRunning)return;
  var speed=Math.hypot(x-lastX,y-lastY);
  if(speed>3){
    for(var i=0;i<fruits.length;i++){
      if(!fruits[i].sliced&&fruits[i].contains(x,y))fruits[i].slice();
    }
  }
}

var pointers={};

canvas.addEventListener('pointerdown',function(e){
  e.preventDefault();
  if(!gameStarted){startGame();return}
  pointers[e.pointerId]={x:e.clientX,y:e.clientY};
  if(!sliceTrails[e.pointerId])sliceTrails[e.pointerId]=[];
  sliceTrails[e.pointerId].push({x:e.clientX,y:e.clientY,alpha:1});
});

canvas.addEventListener('pointermove',function(e){
  e.preventDefault();
  if(!pointers[e.pointerId])return;
  var last=pointers[e.pointerId];
  var x=e.clientX,y=e.clientY;
  checkSlice(x,y,last.x,last.y);
  pointers[e.pointerId]={x:x,y:y};
  if(!sliceTrails[e.pointerId])sliceTrails[e.pointerId]=[];
  sliceTrails[e.pointerId].push({x:x,y:y,alpha:1});
  if(sliceTrails[e.pointerId].length>12)sliceTrails[e.pointerId].shift();
});

canvas.addEventListener('pointerup',function(e){
  e.preventDefault();
  delete pointers[e.pointerId];
  setTimeout(function(){delete sliceTrails[e.pointerId]},200);
});

canvas.addEventListener('pointercancel',function(e){
  delete pointers[e.pointerId];
  delete sliceTrails[e.pointerId];
});

function drawSliceTrails(){
  ctx.lineWidth=6;ctx.lineCap='round';ctx.lineJoin='round';
  for(var id in sliceTrails){
    var trail=sliceTrails[id];
    if(!trail)continue;
    for(var i=0;i<trail.length-1;i++){
      var p=trail[i],np=trail[i+1];
      ctx.save();ctx.globalAlpha=p.alpha*.7;
      ctx.strokeStyle='#fff';ctx.shadowColor='#ffd700';ctx.shadowBlur=12;
      ctx.beginPath();ctx.moveTo(p.x,p.y);ctx.lineTo(np.x,np.y);ctx.stroke();
      ctx.restore();
      p.alpha-=.12;
    }
    for(var i=trail.length-1;i>=0;i--){
      if(trail[i].alpha<=0)trail.splice(i,1);
    }
  }
}

function drawPointers(){
  for(var id in pointers){
    var p=pointers[id];
    ctx.save();ctx.fillStyle='#fff';ctx.shadowColor='#ffd700';ctx.shadowBlur=18;
    ctx.beginPath();ctx.arc(p.x,p.y,10,0,Math.PI*2);ctx.fill();ctx.restore();
  }
}

function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  var grad=ctx.createLinearGradient(0,0,0,canvas.height);
  grad.addColorStop(0,'#87ceeb');grad.addColorStop(1,'#f0e68c');
  ctx.fillStyle=grad;ctx.fillRect(0,0,canvas.width,canvas.height);

  if(gameRunning&&comboTimer>0){comboTimer--;if(comboTimer===0)combo=0}

  for(var i=fruits.length-1;i>=0;i--){
    fruits[i].update();fruits[i].draw();
    if(fruits[i].isOffScreen())fruits.splice(i,1);
  }
  for(var i=particles.length-1;i>=0;i--){
    particles[i].update();particles[i].draw();
    if(particles[i].isDead())particles.splice(i,1);
  }

  drawSliceTrails();
  drawPointers();
  requestAnimationFrame(animate);
}

function addTouchBtn(id,fn){
  var el=document.getElementById(id);
  if(!el)return;
  el.addEventListener('click',function(e){if(!(e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents))fn()});
  el.addEventListener('touchend',function(e){e.preventDefault();e.stopPropagation();fn()});
}
addTouchBtn('backBtn',function(){location.href='../index.html'});
addTouchBtn('playAgainBtn',restartGame);
addTouchBtn('goMenuBtn',function(){location.href='../index.html'});
document.getElementById('startMessage').addEventListener('click',function(e){
  if(!(e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents)&&!gameStarted)startGame();
});
document.getElementById('startMessage').addEventListener('touchend',function(e){
  e.preventDefault();if(!gameStarted)startGame();
});

window.addEventListener('resize',function(){canvas.width=window.innerWidth;canvas.height=window.innerHeight});

animate();
</script>
</body>
</html>
