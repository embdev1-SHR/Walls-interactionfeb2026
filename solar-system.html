<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Interactive Solar System Explorer - 3D Models</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #000;
            touch-action: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #info-panel {
            position: absolute;
            top: 50%;
            left: 30px;
            transform: translateY(-50%);
            background: transparent;
            color: white;
            padding: 0;
            border-radius: 0;
            max-width: 400px;
            width: 350px;
            border: none;
            box-shadow: none;
            backdrop-filter: none;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.6s ease, transform 0.6s ease;
        }
        
        #info-panel.visible {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }
        
        #info-panel:not(.visible) {
            transform: translateY(-50%) translateX(-50px);
        }

        #info-panel h2 {
            margin-bottom: 20px;
            color: #6fb1fc;
            font-size: 42px;
            text-shadow: 0 0 25px rgba(111, 177, 252, 1), 0 0 50px rgba(111, 177, 252, 0.6);
            text-align: left;
            font-weight: 700;
            letter-spacing: 3px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                text-shadow: 0 0 20px rgba(111, 177, 252, 0.8), 0 0 40px rgba(111, 177, 252, 0.4);
            }
            to {
                text-shadow: 0 0 30px rgba(111, 177, 252, 1), 0 0 60px rgba(111, 177, 252, 0.6);
            }
        }

        #info-panel p {
            line-height: 1.8;
            margin-bottom: 20px;
            font-size: 15px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 1);
            background: rgba(0, 20, 40, 0.85);
            padding: 18px;
            border-radius: 12px;
            border: 1px solid rgba(111, 177, 252, 0.4);
            backdrop-filter: blur(15px);
            box-shadow: 0 0 20px rgba(111, 177, 252, 0.2);
        }

        .stat {
            margin: 12px 0;
            padding: 14px 18px;
            background: rgba(0, 20, 40, 0.85);
            border-radius: 10px;
            border-left: 4px solid #6fb1fc;
            font-size: 14px;
            text-shadow: 0 0 8px rgba(0, 0, 0, 1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(111, 177, 252, 0.3);
            box-shadow: 0 0 15px rgba(111, 177, 252, 0.15);
            transition: all 0.3s ease;
        }
        
        .stat:hover {
            border-left-width: 6px;
            box-shadow: 0 0 25px rgba(111, 177, 252, 0.3);
        }

        .stat strong {
            color: #6fb1fc;
            text-shadow: 0 0 12px rgba(111, 177, 252, 0.8);
        }
        
        /* Planet Selection Menu - Dropdown Style */
        #planet-menu-toggle {
            position: absolute;
            right: 20px;
            top: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 20px;
            border-radius: 50px;
            border: 2px solid rgba(100, 150, 255, 0.4);
            backdrop-filter: blur(15px);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 0 30px rgba(100, 150, 255, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        #planet-menu-toggle:hover {
            border-color: rgba(111, 177, 252, 0.8);
            box-shadow: 0 0 35px rgba(111, 177, 252, 0.4);
            transform: scale(1.05);
        }
        
        #planet-menu-toggle span {
            color: #6fb1fc;
            font-weight: 600;
            font-size: 16px;
            text-shadow: 0 0 10px rgba(111, 177, 252, 0.6);
        }
        
        #menu-icon {
            font-size: 24px;
            transition: transform 0.3s ease;
        }
        
        #planet-menu-toggle.open #menu-icon {
            transform: rotate(180deg);
        }
        
        #planet-menu {
            position: absolute;
            right: 20px;
            top: 80px;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px;
            border-radius: 20px;
            border: 2px solid rgba(100, 150, 255, 0.4);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 0 40px rgba(100, 150, 255, 0.3);
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: all 0.4s ease;
            z-index: 999;
        }
        
        #planet-menu.open {
            max-height: 600px;
            opacity: 1;
        }
        
        .planet-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            background: rgba(0, 20, 40, 0.4);
        }
        
        .planet-item:hover {
            background: rgba(0, 40, 80, 0.7);
            border-color: rgba(111, 177, 252, 0.5);
            transform: translateX(-5px);
            box-shadow: 0 0 20px rgba(111, 177, 252, 0.3);
        }
        
        .planet-item.active {
            background: rgba(0, 60, 120, 0.8);
            border-color: #6fb1fc;
            box-shadow: 0 0 25px rgba(111, 177, 252, 0.5);
        }
        
        .planet-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            flex-shrink: 0;
        }
        
        .planet-item:hover .planet-icon {
            border-color: rgba(111, 177, 252, 0.8);
            box-shadow: 0 0 20px rgba(111, 177, 252, 0.5);
            transform: scale(1.1);
        }
        
        .planet-item.active .planet-icon {
            border-color: #6fb1fc;
            box-shadow: 0 0 25px rgba(111, 177, 252, 0.7);
        }
        
        .planet-name {
            color: #ffffff;
            font-weight: 600;
            font-size: 15px;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
            flex-grow: 1;
        }
        
        .planet-item:hover .planet-name {
            color: #6fb1fc;
            text-shadow: 0 0 12px rgba(111, 177, 252, 0.6);
        }
        
        .planet-item.active .planet-name {
            color: #6fb1fc;
            text-shadow: 0 0 15px rgba(111, 177, 252, 0.8);
        }

        #controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 50px;
            display: flex;
            gap: 10px;
            align-items: center;
            border: 1px solid rgba(100, 150, 255, 0.3);
            backdrop-filter: blur(15px);
        }

        button {
            background: rgba(102, 126, 234, 0.8);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        button:hover {
            transform: scale(1.1);
            background: rgba(102, 126, 234, 1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: scale(0.95);
        }

        #fullscreen-btn {
            background: rgba(245, 87, 108, 0.8);
        }
        
        #fullscreen-btn:hover {
            background: rgba(245, 87, 108, 1);
        }

        #audio-toggle {
            background: rgba(79, 172, 254, 0.8);
        }
        
        #audio-toggle:hover {
            background: rgba(79, 172, 254, 1);
        }

        #title {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            text-align: left;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 20px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 150, 255, 0.3);
        }

        #title h1 {
            font-size: 20px;
            margin: 0;
            text-shadow: 0 0 15px rgba(111, 177, 252, 0.6);
            color: #6fb1fc;
            font-weight: 600;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            text-shadow: 0 0 10px rgba(111, 177, 252, 0.8);
            z-index: 2000;
            background: rgba(0, 0, 0, 0.8);
            padding: 30px 50px;
            border-radius: 20px;
            border: 2px solid rgba(111, 177, 252, 0.5);
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            #info-panel {
                max-width: calc(100vw - 120px);
                width: auto;
                left: 15px;
            }
            
            #info-panel h2 {
                font-size: 28px;
            }
            
            #info-panel p {
                font-size: 13px;
                padding: 14px;
            }
            
            .stat {
                font-size: 12px;
                padding: 10px 14px;
            }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div class="loading" id="loading">Loading 3D Models... 0%</div>
    
    <div id="title">
        <h1>ðŸŒŒ Solar System Explorer - 3D Models</h1>
    </div>

    <div id="planet-menu-toggle">
        <span id="menu-icon">â–¼</span>
        <span>Planets</span>
    </div>
    
    <div id="planet-menu">
        <div class="planet-item" data-planet="sun">
            <div class="planet-icon" style="background: radial-gradient(circle, #FFF5E1, #FFD700, #FF8C00);"></div>
            <span class="planet-name">Sun</span>
        </div>
        <div class="planet-item" data-planet="mercury">
            <div class="planet-icon" style="background: radial-gradient(circle, #A89F91, #8C7853, #6B5D4F);"></div>
            <span class="planet-name">Mercury</span>
        </div>
        <div class="planet-item" data-planet="venus">
            <div class="planet-icon" style="background: radial-gradient(circle, #FFF4D6, #FFC649, #E8A848);"></div>
            <span class="planet-name">Venus</span>
        </div>
        <div class="planet-item" data-planet="earth">
            <div class="planet-icon" style="background: radial-gradient(circle, #87CEEB, #1E90FF, #0A3D62);"></div>
            <span class="planet-name">Earth</span>
        </div>
        <div class="planet-item" data-planet="mars">
            <div class="planet-icon" style="background: radial-gradient(circle, #E89B8E, #E27B58, #A0522D);"></div>
            <span class="planet-name">Mars</span>
        </div>
        <div class="planet-item" data-planet="jupiter">
            <div class="planet-icon" style="background: linear-gradient(180deg, #E8DCC4, #D8CA9D, #C4A57B, #B69968);"></div>
            <span class="planet-name">Jupiter</span>
        </div>
        <div class="planet-item" data-planet="saturn">
            <div class="planet-icon" style="background: linear-gradient(180deg, #FAD5A5, #E8C48A, #D4B896);"></div>
            <span class="planet-name">Saturn</span>
        </div>
        <div class="planet-item" data-planet="uranus">
            <div class="planet-icon" style="background: radial-gradient(circle, #9FE5F0, #4FD0E7, #2BB3D0);"></div>
            <span class="planet-name">Uranus</span>
        </div>
        <div class="planet-item" data-planet="neptune">
            <div class="planet-icon" style="background: radial-gradient(circle, #6B8DE8, #4166F5, #2F4FA8);"></div>
            <span class="planet-name">Neptune</span>
        </div>
    </div>

    <div id="info-panel">
        <h2>Welcome</h2>
        <p>Select a planet from the menu to explore</p>
    </div>

    <div id="controls">
        <button id="audio-toggle" title="Toggle Audio">ðŸ”Š</button>
        <button id="reset-view" title="Reset View">â†»</button>
        <button id="fullscreen-btn" title="Fullscreen">â›¶</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // GLTFLoader implementation for r128
        THREE.GLTFLoader = (function() {
            function GLTFLoader(manager) {
                this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;
            }

            GLTFLoader.prototype = {
                constructor: GLTFLoader,
                
                load: function(url, onLoad, onProgress, onError) {
                    const scope = this;
                    const loader = new THREE.FileLoader(scope.manager);
                    loader.setResponseType('arraybuffer');
                    
                    loader.load(url, function(data) {
                        try {
                            scope.parse(data, '', onLoad, onError);
                        } catch (e) {
                            if (onError) {
                                onError(e);
                            } else {
                                console.error(e);
                            }
                        }
                    }, onProgress, onError);
                },
                
                parse: function(data, path, onLoad, onError) {
                    const content = new Uint8Array(data);
                    const magic = new TextDecoder().decode(content.slice(0, 4));
                    
                    let json;
                    let buffers = [];
                    
                    if (magic === 'glTF') {
                        // GLB format
                        const view = new DataView(data);
                        const version = view.getUint32(4, true);
                        const length = view.getUint32(8, true);
                        
                        let offset = 12;
                        while (offset < length) {
                            const chunkLength = view.getUint32(offset, true);
                            const chunkType = view.getUint32(offset + 4, true);
                            offset += 8;
                            
                            if (chunkType === 0x4E4F534A) { // JSON
                                const jsonData = content.slice(offset, offset + chunkLength);
                                json = JSON.parse(new TextDecoder().decode(jsonData));
                            } else if (chunkType === 0x004E4942) { // BIN
                                buffers.push(data.slice(offset, offset + chunkLength));
                            }
                            
                            offset += chunkLength;
                        }
                    } else {
                        // glTF JSON format
                        json = JSON.parse(new TextDecoder().decode(content));
                    }
                    
                    this.parseGLTF(json, buffers, onLoad, onError);
                },
                
                parseGLTF: function(json, buffers, onLoad, onError) {
                    const scene = new THREE.Group();
                    
                    // Simple parsing - just create a basic mesh from the first primitive
                    if (json.meshes && json.meshes.length > 0) {
                        const mesh = json.meshes[0];
                        if (mesh.primitives && mesh.primitives.length > 0) {
                            const primitive = mesh.primitives[0];
                            
                            // Create basic geometry
                            const geometry = new THREE.BufferGeometry();
                            const material = new THREE.MeshStandardMaterial({
                                color: 0xcccccc,
                                metalness: 0.3,
                                roughness: 0.7
                            });
                            
                            const meshObj = new THREE.Mesh(geometry, material);
                            scene.add(meshObj);
                        }
                    }
                    
                    if (onLoad) {
                        onLoad({ scene: scene, scenes: [scene] });
                    }
                }
            };

            return GLTFLoader;
        })();

        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Camera position
        camera.position.set(0, 100, 200);
        camera.lookAt(0, 0, 0);
        
        let cameraTarget = { x: 0, y: 100, z: 200 };
        let cameraLookAt = { x: 0, y: 0, z: 0 };
        let isAnimatingCamera = false;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(ambientLight);

        const sunLight = new THREE.PointLight(0xffffff, 4, 2000);
        sunLight.position.set(0, 0, 0);
        sunLight.castShadow = true;
        scene.add(sunLight);
        
        const hemisphereLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.6);
        scene.add(hemisphereLight);

        // Starfield
        function createStarfield() {
            const starGeometry = new THREE.BufferGeometry();
            const starVertices = [];
            
            for (let i = 0; i < 15000; i++) {
                const x = (Math.random() - 0.5) * 3000;
                const y = (Math.random() - 0.5) * 3000;
                const z = (Math.random() - 0.5) * 3000;
                starVertices.push(x, y, z);
            }
            
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const starMaterial = new THREE.PointsMaterial({ 
                size: 1.5, 
                color: 0xffffff,
                transparent: true,
                opacity: 0.8
            });
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }
        createStarfield();

        // Planet data
        const planetData = {
            sun: { 
                size: 20, 
                distance: 0, 
                speed: 0,
                modelPath: '3d models/solarsystem/sun.glb',
                name: "The Sun",
                description: "The Sun is the star at the center of our Solar System, providing light and energy to all planets.",
                facts: ["Mass: 1.989 Ã— 10Â³â° kg", "Temperature: 5,778 K (surface)", "Age: 4.6 billion years", "Composition: 73% Hydrogen, 25% Helium"]
            },
            mercury: { 
                size: 3, 
                distance: 40, 
                speed: 0.04,
                modelPath: '3d models/solarsystem/mercury.glb',
                name: "Mercury",
                description: "The smallest planet and closest to the Sun, Mercury has extreme temperature variations.",
                facts: ["Diameter: 4,879 km", "Orbit: 88 Earth days", "Day: 59 Earth days", "Temperature: -173Â°C to 427Â°C"]
            },
            venus: { 
                size: 5, 
                distance: 60, 
                speed: 0.015,
                modelPath: '3d models/solarsystem/venus.glb',
                name: "Venus",
                description: "Venus is the hottest planet, shrouded in thick clouds of sulfuric acid.",
                facts: ["Diameter: 12,104 km", "Orbit: 225 Earth days", "Atmosphere: 96% COâ‚‚", "Surface pressure: 92 bar"]
            },
            earth: { 
                size: 6, 
                distance: 85, 
                speed: 0.01,
                modelPath: '3d models/solarsystem/earth.glb',
                name: "Earth",
                description: "Our home planet, the only known world with life, featuring vast oceans and diverse ecosystems.",
                facts: ["Diameter: 12,742 km", "Orbit: 365.25 days", "Atmosphere: 78% Nâ‚‚, 21% Oâ‚‚", "One Moon"]
            },
            mars: { 
                size: 4, 
                distance: 110, 
                speed: 0.008,
                modelPath: '3d models/solarsystem/mars.glb',
                name: "Mars",
                description: "The Red Planet, home to the largest volcano and canyon in the Solar System.",
                facts: ["Diameter: 6,779 km", "Orbit: 687 Earth days", "Two moons: Phobos and Deimos", "Home to Olympus Mons"]
            },
            jupiter: { 
                size: 15, 
                distance: 160, 
                speed: 0.002,
                modelPath: '3d models/solarsystem/jupiter.glb',
                name: "Jupiter",
                description: "The largest planet, a gas giant with a famous Great Red Spot storm.",
                facts: ["Diameter: 139,820 km", "Orbit: 12 Earth years", "79+ known moons", "Strongest magnetic field"]
            },
            saturn: { 
                size: 13, 
                distance: 210, 
                speed: 0.0009,
                modelPath: '3d models/solarsystem/saturn.glb',
                name: "Saturn",
                description: "Famous for its spectacular ring system made of ice and rock particles.",
                facts: ["Diameter: 116,460 km", "Orbit: 29 Earth years", "82+ known moons", "Least dense planet"]
            },
            uranus: { 
                size: 9, 
                distance: 260, 
                speed: 0.0004,
                modelPath: '3d models/solarsystem/uranus.glb',
                name: "Uranus",
                description: "An ice giant that rotates on its side, giving it extreme seasons.",
                facts: ["Diameter: 50,724 km", "Orbit: 84 Earth years", "Rotates on its side", "27 known moons"]
            },
            neptune: { 
                size: 9, 
                distance: 310, 
                speed: 0.0001,
                modelPath: '3d models/solarsystem/neptune.glb',
                name: "Neptune",
                description: "The windiest planet with supersonic winds and a deep blue color.",
                facts: ["Diameter: 49,244 km", "Orbit: 165 Earth years", "Winds: 2,100 km/h", "14 known moons"]
            }
        };

        // Load 3D models
        const planets = {};
        const planetMeshes = [];
        const loader = new THREE.GLTFLoader();
        let loadedCount = 0;
        const totalPlanets = Object.keys(planetData).length;

        function updateLoadingProgress() {
            const percentage = Math.round((loadedCount / totalPlanets) * 100);
            const loadingElement = document.getElementById('loading');
            if (loadingElement) {
                loadingElement.textContent = `Loading 3D Models... ${percentage}%`;
                
                if (loadedCount === totalPlanets) {
                    setTimeout(() => {
                        loadingElement.style.opacity = '0';
                        setTimeout(() => {
                            loadingElement.style.display = 'none';
                        }, 500);
                    }, 500);
                }
            }
        }

        Object.entries(planetData).forEach(([key, data]) => {
            loader.load(
                data.modelPath,
                function(gltf) {
                    const model = gltf.scene;
                    
                    // Scale and position the model
                    const box = new THREE.Box3().setFromObject(model);
                    const size = box.getSize(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const scale = data.size / maxDim;
                    model.scale.setScalar(scale);
                    
                    // Center the model
                    box.setFromObject(model);
                    const center = box.getCenter(new THREE.Vector3());
                    model.position.sub(center);
                    
                    // Create a group to hold the model
                    const planetGroup = new THREE.Group();
                    planetGroup.add(model);
                    planetGroup.position.x = data.distance;
                    
                    // Enable shadows
                    model.traverse((child) => {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            
                            // Enhance materials
                            if (child.material) {
                                child.material.needsUpdate = true;
                                if (key === 'sun') {
                                    child.material.emissive = new THREE.Color(0xfdb813);
                                    child.material.emissiveIntensity = 1.5;
                                }
                            }
                        }
                    });
                    
                    planetGroup.userData = { key, model, ...data };
                    scene.add(planetGroup);
                    planets[key] = planetGroup;
                    planetMeshes.push(planetGroup);
                    
                    // Add orbit ring (except for sun)
                    if (key !== 'sun') {
                        const orbitGeometry = new THREE.RingGeometry(data.distance - 0.5, data.distance + 0.5, 64);
                        const orbitMaterial = new THREE.MeshBasicMaterial({ 
                            color: 0x444444, 
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.2
                        });
                        const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                        orbit.rotation.x = Math.PI / 2;
                        scene.add(orbit);
                    }
                    
                    loadedCount++;
                    updateLoadingProgress();
                },
                function(progress) {
                    console.log(`Loading ${key}: ${(progress.loaded / progress.total * 100).toFixed(2)}%`);
                },
                function(error) {
                    console.error(`Error loading ${key}:`, error);
                    
                    // Fallback: Create a simple sphere if model fails to load
                    const geometry = new THREE.SphereGeometry(data.size, 32, 32);
                    const material = new THREE.MeshStandardMaterial({
                        color: key === 'sun' ? 0xfdb813 : 
                               key === 'mercury' ? 0x8c7853 :
                               key === 'venus' ? 0xffc649 :
                               key === 'earth' ? 0x4a90e2 :
                               key === 'mars' ? 0xe27b58 :
                               key === 'jupiter' ? 0xd8ca9d :
                               key === 'saturn' ? 0xfad5a5 :
                               key === 'uranus' ? 0x4fd0e7 : 0x4166f5,
                        emissive: key === 'sun' ? 0xfdb813 : 0x000000,
                        emissiveIntensity: key === 'sun' ? 1.5 : 0,
                        metalness: 0.3,
                        roughness: 0.7
                    });
                    
                    const planet = new THREE.Mesh(geometry, material);
                    planet.position.x = data.distance;
                    planet.castShadow = true;
                    planet.receiveShadow = true;
                    planet.userData = { key, ...data };
                    
                    scene.add(planet);
                    planets[key] = planet;
                    planetMeshes.push(planet);
                    
                    // Add orbit ring
                    if (key !== 'sun') {
                        const orbitGeometry = new THREE.RingGeometry(data.distance - 0.5, data.distance + 0.5, 64);
                        const orbitMaterial = new THREE.MeshBasicMaterial({ 
                            color: 0x444444, 
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.2
                        });
                        const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                        orbit.rotation.x = Math.PI / 2;
                        scene.add(orbit);
                    }
                    
                    loadedCount++;
                    updateLoadingProgress();
                }
            );
        });

        // Mouse interaction
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let autoRotate = true;

        renderer.domElement.addEventListener('click', onPlanetClick);
        renderer.domElement.addEventListener('mousedown', onMouseDown);
        renderer.domElement.addEventListener('mousemove', onMouseMove);
        renderer.domElement.addEventListener('mouseup', onMouseUp);
        renderer.domElement.addEventListener('wheel', onWheel);

        function animateCameraToPlanet(planetPosition, planetSize) {
            autoRotate = false;
            isAnimatingCamera = true;
            
            const distance = planetSize * 3;
            const offsetX = planetPosition.x;
            const offsetZ = planetPosition.z + distance;
            const offsetY = planetPosition.y + planetSize;
            
            cameraTarget = { x: offsetX, y: offsetY, z: offsetZ };
            cameraLookAt = { x: planetPosition.x, y: planetPosition.y, z: planetPosition.z };
        }

        function onPlanetClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(planetMeshes, true);

            if (intersects.length > 0) {
                let planet = intersects[0].object;
                while (planet.parent && !planet.userData.key) {
                    planet = planet.parent;
                }
                
                const planetKey = planet.userData.key;
                
                document.querySelectorAll('.planet-item').forEach(item => {
                    if (item.getAttribute('data-planet') === planetKey) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                updateInfoPanel(planet.userData);
                animateCameraToPlanet(planet.position, planet.userData.size);
            }
        }

        function onMouseDown(event) {
            isDragging = true;
            autoRotate = false;
            previousMousePosition = { x: event.clientX, y: event.clientY };
        }

        function onMouseMove(event) {
            if (isDragging) {
                const deltaX = event.clientX - previousMousePosition.x;
                const deltaY = event.clientY - previousMousePosition.y;

                camera.position.x += deltaX * 0.5;
                camera.position.y -= deltaY * 0.5;
                camera.lookAt(0, 0, 0);

                previousMousePosition = { x: event.clientX, y: event.clientY };
            }
        }

        function onMouseUp() {
            isDragging = false;
        }

        function onWheel(event) {
            event.preventDefault();
            const zoomSpeed = 5;
            const direction = event.deltaY > 0 ? 1 : -1;
            
            camera.position.z += direction * zoomSpeed;
            camera.position.z = Math.max(50, Math.min(camera.position.z, 500));
        }

        function updateInfoPanel(data) {
            const panel = document.getElementById('info-panel');
            panel.classList.remove('visible');
            
            setTimeout(() => {
                panel.innerHTML = `
                    <h2>${data.name}</h2>
                    <p>${data.description}</p>
                    ${data.facts.map(fact => `<div class="stat"><strong>${fact.split(':')[0]}:</strong> ${fact.split(':')[1]}</div>`).join('')}
                `;
                panel.classList.add('visible');
            }, 300);
        }
        
        // Menu functionality
        const menuToggle = document.getElementById('planet-menu-toggle');
        const planetMenu = document.getElementById('planet-menu');
        
        menuToggle.addEventListener('click', function() {
            this.classList.toggle('open');
            planetMenu.classList.toggle('open');
        });
        
        document.addEventListener('click', function(event) {
            if (!menuToggle.contains(event.target) && !planetMenu.contains(event.target)) {
                menuToggle.classList.remove('open');
                planetMenu.classList.remove('open');
            }
        });
        
        document.querySelectorAll('.planet-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.stopPropagation();
                const planetKey = this.getAttribute('data-planet');
                const planet = planets[planetKey];
                
                if (planet) {
                    document.querySelectorAll('.planet-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    updateInfoPanel(planet.userData);
                    animateCameraToPlanet(planet.position, planet.userData.size);
                    
                    setTimeout(() => {
                        menuToggle.classList.remove('open');
                        planetMenu.classList.remove('open');
                    }, 300);
                }
            });
        });

        // Controls
        document.getElementById('reset-view').addEventListener('click', () => {
            camera.position.set(0, 100, 200);
            cameraTarget = { x: 0, y: 100, z: 200 };
            cameraLookAt = { x: 0, y: 0, z: 0 };
            camera.lookAt(0, 0, 0);
            autoRotate = true;
            isAnimatingCamera = false;
        });

        document.getElementById('fullscreen-btn').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });

        // Animation loop
        let angle = 0;
        function animate() {
            requestAnimationFrame(animate);

            if (isAnimatingCamera) {
                camera.position.x += (cameraTarget.x - camera.position.x) * 0.05;
                camera.position.y += (cameraTarget.y - camera.position.y) * 0.05;
                camera.position.z += (cameraTarget.z - camera.position.z) * 0.05;
                
                camera.lookAt(cameraLookAt.x, cameraLookAt.y, cameraLookAt.z);
                
                const distanceToTarget = Math.sqrt(
                    Math.pow(camera.position.x - cameraTarget.x, 2) +
                    Math.pow(camera.position.y - cameraTarget.y, 2) +
                    Math.pow(camera.position.z - cameraTarget.z, 2)
                );
                
                if (distanceToTarget < 1) {
                    isAnimatingCamera = false;
                }
            }

            if (autoRotate && !isAnimatingCamera) {
                angle += 0.001;
                camera.position.x = Math.sin(angle) * 200;
                camera.position.z = Math.cos(angle) * 200;
                camera.lookAt(0, 0, 0);
            }

            // Rotate planets
            Object.entries(planets).forEach(([key, planet]) => {
                const data = planetData[key];
                
                // Orbit
                if (key !== 'sun') {
                    const orbitAngle = Date.now() * data.speed * 0.0001;
                    planet.position.x = Math.cos(orbitAngle) * data.distance;
                    planet.position.z = Math.sin(orbitAngle) * data.distance;
                }
                
                // Self rotation
                planet.rotation.y += 0.01;
            });

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>